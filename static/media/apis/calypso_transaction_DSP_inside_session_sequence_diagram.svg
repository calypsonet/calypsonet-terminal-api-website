<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentStyleType="text/css" height="3002px" preserveAspectRatio="none" style="width:1410px;height:3002px;background:#FFFFFF;" version="1.1" viewBox="0 0 1410 3002" width="1410px" zoomAndPan="magnify"><defs/><g><rect fill="#FFD700" height="2820.5391" style="stroke:#181818;stroke-width:1.0;" width="10" x="75.5" y="91.4883"/><rect fill="#FFC0CB" height="14" style="stroke:#181818;stroke-width:1.0;" width="10" x="373.5" y="282.2832"/><rect fill="#FFC0CB" height="799.248" style="stroke:#181818;stroke-width:1.0;" width="10" x="373.5" y="325.5938"/><rect fill="#FFC0CB" height="14" style="stroke:#181818;stroke-width:1.0;" width="10" x="373.5" y="1184.7734"/><rect fill="#FFC0CB" height="560.9004" style="stroke:#181818;stroke-width:1.0;" width="10" x="373.5" y="1228.084"/><rect fill="#FFC0CB" height="14" style="stroke:#181818;stroke-width:1.0;" width="10" x="373.5" y="1864.2266"/><rect fill="#FFC0CB" height="960.1797" style="stroke:#181818;stroke-width:1.0;" width="10" x="373.5" y="1942.8477"/><rect fill="#ADD8E6" height="267.1055" style="stroke:#181818;stroke-width:1.0;" width="10" x="631.5" y="721.252"/><rect fill="#ADD8E6" height="307.7949" style="stroke:#181818;stroke-width:1.0;" width="10" x="631.5" y="2310.8848"/><rect fill="#ADD8E6" height="2497.8809" style="stroke:#181818;stroke-width:1.0;" width="10" x="901.5" y="91.4883"/><rect fill="#90EE90" height="275.7949" style="stroke:#181818;stroke-width:1.0;" width="10" x="993.5" y="385.5254"/><rect fill="#90EE90" height="441.0371" style="stroke:#181818;stroke-width:1.0;" width="10" x="993.5" y="1288.0156"/><rect fill="#90EE90" height="205.8633" style="stroke:#181818;stroke-width:1.0;" width="10" x="993.5" y="2045.0898"/><rect fill="#90EE90" height="87.9316" style="stroke:#181818;stroke-width:1.0;" width="10" x="993.5" y="2678.6113"/><rect fill="#90EE90" height="2820.5391" style="stroke:#181818;stroke-width:1.0;" width="10" x="1320.5" y="91.4883"/><rect height="223.7949" style="stroke:#000000;stroke-width:1.5;fill:none;" width="373.5" x="574" y="736.252"/><rect height="103.9316" style="stroke:#000000;stroke-width:1.5;fill:none;" width="429" x="937.5" y="2060.0898"/><rect height="119.2422" style="stroke:#000000;stroke-width:1.5;fill:none;" width="373.5" x="574" y="2325.8848"/><line style="stroke:#181818;stroke-width:0.5;fill:none;stroke-dasharray:5.0,5.0;" x1="80" x2="80" y1="81.4883" y2="2921.0273"/><line style="stroke:#181818;stroke-width:0.5;fill:none;stroke-dasharray:5.0,5.0;" x1="378.5" x2="378.5" y1="81.4883" y2="2921.0273"/><line style="stroke:#181818;stroke-width:0.5;fill:none;stroke-dasharray:5.0,5.0;" x1="636" x2="636" y1="81.4883" y2="2921.0273"/><line style="stroke:#181818;stroke-width:0.5;fill:none;stroke-dasharray:5.0,5.0;" x1="906.5" x2="906.5" y1="81.4883" y2="2921.0273"/><line style="stroke:#181818;stroke-width:0.5;fill:none;stroke-dasharray:5.0,5.0;" x1="998.5" x2="998.5" y1="81.4883" y2="2921.0273"/><line style="stroke:#181818;stroke-width:0.5;fill:none;stroke-dasharray:5.0,5.0;" x1="1325.5" x2="1325.5" y1="81.4883" y2="2921.0273"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="145" x="5" y="78.5352">Ticketing Application</text><ellipse cx="80.5" cy="13.5" fill="#FFD700" rx="8" ry="8" style="stroke:#181818;stroke-width:0.5;"/><path d="M80.5,21.5 L80.5,48.5 M67.5,29.5 L93.5,29.5 M80.5,48.5 L67.5,63.5 M80.5,48.5 L93.5,63.5 " fill="none" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="145" x="5" y="2933.5625">Ticketing Application</text><ellipse cx="80.5" cy="2945.0156" fill="#FFD700" rx="8" ry="8" style="stroke:#181818;stroke-width:0.5;"/><path d="M80.5,2953.0156 L80.5,2980.0156 M67.5,2961.0156 L93.5,2961.0156 M80.5,2980.0156 L67.5,2995.0156 M80.5,2980.0156 L93.5,2995.0156 " fill="none" style="stroke:#181818;stroke-width:0.5;"/><rect fill="#FFC0CB" height="30.4883" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="94" x="331.5" y="50"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="80" x="338.5" y="70.5352">Calypso API</text><rect fill="#FFC0CB" height="30.4883" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="94" x="331.5" y="2920.0273"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="80" x="338.5" y="2940.5625">Calypso API</text><rect fill="#ADD8E6" height="46.9766" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="105" x="584" y="33.5117"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="91" x="591" y="54.0469">Calypso Card</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="48" x="612.5" y="70.5352">Reader</text><rect fill="#ADD8E6" height="46.9766" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="105" x="584" y="2920.0273"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="91" x="591" y="2940.5625">Calypso Card</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="48" x="612.5" y="2957.0508">Reader</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="56" x="875.5" y="62.0469">selected</text><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="33" x="887" y="78.5352">Card</text><path d="M886,20.5117 L886,44.5117 M886,32.5117 L903,32.5117 " fill="none" style="stroke:#181818;stroke-width:0.5;"/><ellipse cx="915" cy="32.5117" fill="#ADD8E6" rx="12" ry="12" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="56" x="875.5" y="2933.5625">selected</text><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="33" x="887" y="2950.0508">Card</text><path d="M886,2957.0039 L886,2981.0039 M886,2969.0039 L903,2969.0039 " fill="none" style="stroke:#181818;stroke-width:0.5;"/><ellipse cx="915" cy="2969.0039" fill="#ADD8E6" rx="12" ry="12" style="stroke:#181818;stroke-width:0.5;"/><rect fill="#90EE90" height="46.9766" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="102" x="947.5" y="33.5117"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="88" x="954.5" y="54.0469">Calypso SAM</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="48" x="974.5" y="70.5352">Reader</text><rect fill="#90EE90" height="46.9766" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="102" x="947.5" y="2920.0273"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="88" x="954.5" y="2940.5625">Calypso SAM</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="48" x="974.5" y="2957.0508">Reader</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="56" x="1294.5" y="62.0469">selected</text><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="31" x="1307" y="78.5352">SAM</text><path d="M1305,20.5117 L1305,44.5117 M1305,32.5117 L1322,32.5117 " fill="none" style="stroke:#181818;stroke-width:0.5;"/><ellipse cx="1334" cy="32.5117" fill="#90EE90" rx="12" ry="12" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="56" x="1294.5" y="2933.5625">selected</text><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="31" x="1307" y="2950.0508">SAM</text><path d="M1305,2957.0039 L1305,2981.0039 M1305,2969.0039 L1322,2969.0039 " fill="none" style="stroke:#181818;stroke-width:0.5;"/><ellipse cx="1334" cy="2969.0039" fill="#90EE90" rx="12" ry="12" style="stroke:#181818;stroke-width:0.5;"/><rect fill="#FFD700" height="2820.5391" style="stroke:#181818;stroke-width:1.0;" width="10" x="75.5" y="91.4883"/><rect fill="#FFC0CB" height="14" style="stroke:#181818;stroke-width:1.0;" width="10" x="373.5" y="282.2832"/><rect fill="#FFC0CB" height="799.248" style="stroke:#181818;stroke-width:1.0;" width="10" x="373.5" y="325.5938"/><rect fill="#FFC0CB" height="14" style="stroke:#181818;stroke-width:1.0;" width="10" x="373.5" y="1184.7734"/><rect fill="#FFC0CB" height="560.9004" style="stroke:#181818;stroke-width:1.0;" width="10" x="373.5" y="1228.084"/><rect fill="#FFC0CB" height="14" style="stroke:#181818;stroke-width:1.0;" width="10" x="373.5" y="1864.2266"/><rect fill="#FFC0CB" height="960.1797" style="stroke:#181818;stroke-width:1.0;" width="10" x="373.5" y="1942.8477"/><rect fill="#ADD8E6" height="267.1055" style="stroke:#181818;stroke-width:1.0;" width="10" x="631.5" y="721.252"/><rect fill="#ADD8E6" height="307.7949" style="stroke:#181818;stroke-width:1.0;" width="10" x="631.5" y="2310.8848"/><rect fill="#ADD8E6" height="2497.8809" style="stroke:#181818;stroke-width:1.0;" width="10" x="901.5" y="91.4883"/><rect fill="#90EE90" height="275.7949" style="stroke:#181818;stroke-width:1.0;" width="10" x="993.5" y="385.5254"/><rect fill="#90EE90" height="441.0371" style="stroke:#181818;stroke-width:1.0;" width="10" x="993.5" y="1288.0156"/><rect fill="#90EE90" height="205.8633" style="stroke:#181818;stroke-width:1.0;" width="10" x="993.5" y="2045.0898"/><rect fill="#90EE90" height="87.9316" style="stroke:#181818;stroke-width:1.0;" width="10" x="993.5" y="2678.6113"/><rect fill="#90EE90" height="2820.5391" style="stroke:#181818;stroke-width:1.0;" width="10" x="1320.5" y="91.4883"/><line style="stroke:#181818;stroke-width:1.0;" x1="85.5" x2="127.5" y1="143.4199" y2="143.4199"/><line style="stroke:#181818;stroke-width:1.0;" x1="127.5" x2="127.5" y1="143.4199" y2="156.4199"/><line style="stroke:#181818;stroke-width:1.0;" x1="86.5" x2="127.5" y1="156.4199" y2="156.4199"/><polygon fill="#181818" points="96.5,152.4199,86.5,156.4199,96.5,160.4199,92.5,156.4199" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="72" x="92.5" y="108.0566">instantiate</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="160" x="168.5" y="108.0566">Calypso card transaction:</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="151" x="124.5" y="123.3672">- Calypso card resource</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="151" x="124.5" y="138.6777">- Calypso SAM resource</text><path d="M155,169.4199 L155,194.4199 L601,194.4199 L601,179.4199 L591,169.4199 L155,169.4199 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M591,169.4199 L591,179.4199 L601,179.4199 L591,169.4199 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="425" x="161" y="186.9883">Checks a signature of previously read data when selecting the card.</text><polygon fill="#181818" points="361.5,278.2832,371.5,282.2832,361.5,286.2832,365.5,282.2832" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="85.5" x2="367.5" y1="282.2832" y2="282.2832"/><text fill="#FF0000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="54" x="92.5" y="216.2988">prepare</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="106" x="150.5" y="216.2988">card transaction:</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="146" x="124.5" y="231.6094">- read environment file</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="8" x="124.5" y="246.9199">-</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="39" x="136.5" y="246.9199">verify</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="110" x="179.5" y="246.9199">environment data</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="65" x="293.5" y="246.9199">signature</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="115" x="124.5" y="262.2305">- read contract #1</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="123" x="124.5" y="277.541">- reader counter #1</text><polygon fill="#181818" points="96.5,292.2832,86.5,296.2832,96.5,300.2832,92.5,296.2832" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="90.5" x2="377.5" y1="296.2832" y2="296.2832"/><polygon fill="#181818" points="361.5,321.5938,371.5,325.5938,361.5,329.5938,365.5,325.5938" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="85.5" x2="367.5" y1="325.5938" y2="325.5938"/><text fill="#FF0000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="52" x="92.5" y="320.8516">process</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="178" x="148.5" y="320.8516">opening (DEBIT access level)</text><polygon fill="#00FF00" points="981.5,381.5254,991.5,385.5254,981.5,389.5254,985.5,385.5254" style="stroke:#00FF00;stroke-width:1.0;"/><line style="stroke:#00FF00;stroke-width:1.0;" x1="383.5" x2="987.5" y1="385.5254" y2="385.5254"/><text fill="#008000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="51" x="390.5" y="350.1621">SAM #1</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="135" x="390.5" y="365.4727">transmit card request</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="71" x="422.5" y="380.7832">- APDU list</text><path d="M704,398.5254 L704,423.5254 L1292,423.5254 L1292,408.5254 L1282,398.5254 L704,398.5254 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M1282,398.5254 L1282,408.5254 L1292,408.5254 L1282,398.5254 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="567" x="710" y="416.0938">A specific signature key diversification could be required before the signature processing.</text><polygon fill="#181818" points="1308.5,446.1465,1318.5,450.1465,1308.5,454.1465,1312.5,450.1465" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="1003.5" x2="1314.5" y1="450.1465" y2="450.1465"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="108" x="1010.5" y="445.4043">verify signature</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="181" x="1122.5" y="445.4043">(environment data signature)</text><polygon fill="#181818" points="1014.5,475.457,1004.5,479.457,1014.5,483.457,1010.5,479.457" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="1008.5" x2="1319.5" y1="479.457" y2="479.457"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="102" x="1020.5" y="474.7148">signature status</text><path d="M593,492.457 L593,517.457 L1403,517.457 L1403,502.457 L1393,492.457 L593,492.457 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M1393,492.457 L1393,502.457 L1403,502.457 L1393,492.457 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="789" x="599" y="510.0254">A session key diversification is operated, if the diversifier is different than for the previous data secure processing operation.</text><polygon fill="#181818" points="1308.5,540.0781,1318.5,544.0781,1308.5,548.0781,1312.5,544.0781" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="1003.5" x2="1314.5" y1="544.0781" y2="544.0781"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="181" x="1010.5" y="539.3359">select diversifier (card serial)</text><polygon fill="#181818" points="1014.5,554.0781,1004.5,558.0781,1014.5,562.0781,1010.5,558.0781" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="1008.5" x2="1319.5" y1="558.0781" y2="558.0781"/><polygon fill="#181818" points="1308.5,583.3887,1318.5,587.3887,1308.5,591.3887,1312.5,587.3887" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="1003.5" x2="1314.5" y1="587.3887" y2="587.3887"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="84" x="1010.5" y="582.6465">get challenge</text><polygon fill="#181818" points="1014.5,612.6992,1004.5,616.6992,1014.5,620.6992,1010.5,616.6992" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="1008.5" x2="1319.5" y1="616.6992" y2="616.6992"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="99" x="1020.5" y="611.957">[SAM challenge]</text><polygon fill="#00FF00" points="394.5,657.3203,384.5,661.3203,394.5,665.3203,390.5,661.3203" style="stroke:#00FF00;stroke-width:1.0;"/><line style="stroke:#00FF00;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="388.5" x2="997.5" y1="661.3203" y2="661.3203"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="181" x="400.5" y="641.2676">[environment data signature,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="95" x="400.5" y="656.5781">SAM challenge]</text><polygon fill="#0000FF" points="619.5,717.252,629.5,721.252,619.5,725.252,623.5,721.252" style="stroke:#0000FF;stroke-width:1.0;"/><line style="stroke:#0000FF;stroke-width:1.0;" x1="383.5" x2="625.5" y1="721.252" y2="721.252"/><text fill="#0000FF" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="54" x="390.5" y="685.8887">Card #2</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="135" x="390.5" y="701.1992">transmit card request</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="71" x="422.5" y="716.5098">- APDU list</text><path d="M574,736.252 L870,736.252 L870,743.5625 L860,753.5625 L574,753.5625 L574,736.252 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.5;"/><rect fill="none" height="223.7949" style="stroke:#000000;stroke-width:1.5;" width="373.5" x="574" y="736.252"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="251" x="589" y="749.8203">Card APDU commands inside session</text><polygon fill="#181818" points="889.5,801.4941,899.5,805.4941,889.5,809.4941,893.5,805.4941" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="641.5" x2="895.5" y1="805.4941" y2="805.4941"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="229" x="648.5" y="770.1309">open secure session (card debit key,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="95" x="680.5" y="785.4414">SAM challenge,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="153" x="680.5" y="800.752">SFI environment to read)</text><polygon fill="#181818" points="652.5,830.8047,642.5,834.8047,652.5,838.8047,648.5,834.8047" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="646.5" x2="900.5" y1="834.8047" y2="834.8047"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="226" x="658.5" y="830.0625">[card challenge &amp; environment data]</text><polygon fill="#181818" points="889.5,860.1152,899.5,864.1152,889.5,868.1152,893.5,864.1152" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="641.5" x2="895.5" y1="864.1152" y2="864.1152"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="155" x="648.5" y="859.373">read record (contract #1)</text><polygon fill="#181818" points="652.5,889.4258,642.5,893.4258,652.5,897.4258,648.5,893.4258" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="646.5" x2="900.5" y1="893.4258" y2="893.4258"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="111" x="658.5" y="888.6836">[contract #1 data]</text><polygon fill="#181818" points="889.5,918.7363,899.5,922.7363,889.5,926.7363,893.5,922.7363" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="641.5" x2="895.5" y1="922.7363" y2="922.7363"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="151" x="648.5" y="917.9941">read record (counter #1)</text><polygon fill="#181818" points="652.5,948.0469,642.5,952.0469,652.5,956.0469,648.5,952.0469" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="646.5" x2="900.5" y1="952.0469" y2="952.0469"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="107" x="658.5" y="947.3047">[counter #1 data]</text><polygon fill="#0000FF" points="394.5,984.3574,384.5,988.3574,394.5,992.3574,390.5,988.3574" style="stroke:#0000FF;stroke-width:1.0;"/><line style="stroke:#0000FF;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="388.5" x2="635.5" y1="988.3574" y2="988.3574"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="99" x="400.5" y="983.6152">[card challenge]</text><polygon fill="#181818" points="96.5,1120.8418,86.5,1124.8418,96.5,1128.8418,92.5,1124.8418" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="90.5" x2="377.5" y1="1124.8418" y2="1124.8418"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="131" x="102.5" y="1012.9258">[Calypso card image:</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="127" x="134.5" y="1028.2363">- identification data</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="185" x="134.5" y="1043.5469">- environment data (updated)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="119" x="134.5" y="1058.8574">- contract list data</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="115" x="134.5" y="1074.168">- contract #1 data</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="115" x="134.5" y="1089.4785">- counter #1 data]</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="155" x="102.5" y="1104.7891">[Data secure processing:</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="232" x="134.5" y="1120.0996">- environment data signature status]</text><polygon fill="#181818" points="361.5,1180.7734,371.5,1184.7734,361.5,1188.7734,365.5,1184.7734" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="85.5" x2="367.5" y1="1184.7734" y2="1184.7734"/><text fill="#FF0000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="54" x="92.5" y="1149.4102">prepare</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="159" x="150.5" y="1149.4102">secured card transaction:</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="8" x="124.5" y="1164.7207">-</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="39" x="136.5" y="1164.7207">verify</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="103" x="179.5" y="1164.7207">contract #1 data</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="65" x="286.5" y="1164.7207">signature</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="8" x="124.5" y="1180.0313">-</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="59" x="136.5" y="1180.0313">compute</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="65" x="199.5" y="1180.0313">event data</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="65" x="268.5" y="1180.0313">signature</text><polygon fill="#181818" points="96.5,1194.7734,86.5,1198.7734,96.5,1202.7734,92.5,1198.7734" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="90.5" x2="377.5" y1="1198.7734" y2="1198.7734"/><polygon fill="#181818" points="361.5,1224.084,371.5,1228.084,361.5,1232.084,365.5,1228.084" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="85.5" x2="367.5" y1="1228.084" y2="1228.084"/><text fill="#FF0000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="52" x="92.5" y="1223.3418">process</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="69" x="148.5" y="1223.3418">commands</text><polygon fill="#00FF00" points="981.5,1284.0156,991.5,1288.0156,981.5,1292.0156,985.5,1288.0156" style="stroke:#00FF00;stroke-width:1.0;"/><line style="stroke:#00FF00;stroke-width:1.0;" x1="383.5" x2="987.5" y1="1288.0156" y2="1288.0156"/><text fill="#008000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="51" x="390.5" y="1252.6523">SAM #2</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="135" x="390.5" y="1267.9629">transmit card request</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="71" x="422.5" y="1283.2734">- APDU list</text><path d="M737,1301.0156 L737,1326.0156 L1260,1326.0156 L1260,1311.0156 L1250,1301.0156 L737,1301.0156 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M1250,1301.0156 L1250,1311.0156 L1260,1311.0156 L1250,1301.0156 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="502" x="743" y="1318.584">When data secure processing requested, processes all pending SAM commands.</text><polygon fill="#181818" points="1308.5,1348.6367,1318.5,1352.6367,1308.5,1356.6367,1312.5,1352.6367" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="1003.5" x2="1314.5" y1="1352.6367" y2="1352.6367"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="158" x="1010.5" y="1347.8945">digest init (opening data)</text><polygon fill="#181818" points="1014.5,1362.6367,1004.5,1366.6367,1014.5,1370.6367,1010.5,1366.6367" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="1008.5" x2="1319.5" y1="1366.6367" y2="1366.6367"/><polygon fill="#181818" points="1308.5,1391.9473,1318.5,1395.9473,1308.5,1399.9473,1312.5,1395.9473" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="1003.5" x2="1314.5" y1="1395.9473" y2="1395.9473"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="208" x="1010.5" y="1391.2051">digest update (read environment)</text><polygon fill="#181818" points="1014.5,1405.9473,1004.5,1409.9473,1014.5,1413.9473,1010.5,1409.9473" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="1008.5" x2="1319.5" y1="1409.9473" y2="1409.9473"/><polygon fill="#181818" points="1308.5,1435.2578,1318.5,1439.2578,1308.5,1443.2578,1312.5,1439.2578" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="1003.5" x2="1314.5" y1="1439.2578" y2="1439.2578"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="181" x="1010.5" y="1434.5156">digest update (read contract)</text><polygon fill="#181818" points="1014.5,1449.2578,1004.5,1453.2578,1014.5,1457.2578,1010.5,1453.2578" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="1008.5" x2="1319.5" y1="1453.2578" y2="1453.2578"/><polygon fill="#181818" points="1308.5,1478.5684,1318.5,1482.5684,1308.5,1486.5684,1312.5,1482.5684" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="1003.5" x2="1314.5" y1="1482.5684" y2="1482.5684"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="177" x="1010.5" y="1477.8262">digest update (read counter)</text><polygon fill="#181818" points="1014.5,1492.5684,1004.5,1496.5684,1014.5,1500.5684,1010.5,1496.5684" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="1008.5" x2="1319.5" y1="1496.5684" y2="1496.5684"/><path d="M634,1509.5684 L634,1534.5684 L1362,1534.5684 L1362,1519.5684 L1352,1509.5684 L634,1509.5684 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M1352,1509.5684 L1352,1519.5684 L1362,1519.5684 L1352,1509.5684 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="707" x="640" y="1527.1367">If necessary, a specific contract signature key diversification could be operated before the signature processing.</text><polygon fill="#181818" points="1308.5,1557.1895,1318.5,1561.1895,1308.5,1565.1895,1312.5,1561.1895" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="1003.5" x2="1314.5" y1="1561.1895" y2="1561.1895"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="108" x="1010.5" y="1556.4473">verify signature</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="174" x="1122.5" y="1556.4473">(contract #1 data signature)</text><polygon fill="#181818" points="1014.5,1586.5,1004.5,1590.5,1014.5,1594.5,1010.5,1590.5" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="1008.5" x2="1319.5" y1="1590.5" y2="1590.5"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="102" x="1020.5" y="1585.7578">signature status</text><path d="M643,1603.5 L643,1628.5 L1353,1628.5 L1353,1613.5 L1343,1603.5 L643,1603.5 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M1343,1603.5 L1343,1613.5 L1353,1613.5 L1343,1603.5 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="689" x="649" y="1621.0684">If necessary, a specific event signature key diversification could be operated before the signature processing.</text><polygon fill="#181818" points="1308.5,1651.1211,1318.5,1655.1211,1308.5,1659.1211,1312.5,1655.1211" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="1003.5" x2="1314.5" y1="1655.1211" y2="1655.1211"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="128" x="1010.5" y="1650.3789">compute signature</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="73" x="1142.5" y="1650.3789">(event data)</text><polygon fill="#181818" points="1014.5,1680.4316,1004.5,1684.4316,1014.5,1688.4316,1010.5,1684.4316" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="1008.5" x2="1319.5" y1="1684.4316" y2="1684.4316"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="128" x="1020.5" y="1679.6895">event data signature</text><polygon fill="#00FF00" points="394.5,1725.0527,384.5,1729.0527,394.5,1733.0527,390.5,1729.0527" style="stroke:#00FF00;stroke-width:1.0;"/><line style="stroke:#00FF00;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="388.5" x2="997.5" y1="1729.0527" y2="1729.0527"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="217" x="400.5" y="1709">[contract #1 data signature status,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="132" x="400.5" y="1724.3105">event data signature]</text><polygon fill="#181818" points="96.5,1784.9844,86.5,1788.9844,96.5,1792.9844,92.5,1788.9844" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="90.5" x2="377.5" y1="1788.9844" y2="1788.9844"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="155" x="102.5" y="1753.6211">[Data secure processing:</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="221" x="134.5" y="1768.9316">- contract #1 data signature status</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="144" x="134.5" y="1784.2422">- event data signature]</text><polygon fill="#181818" points="361.5,1860.2266,371.5,1864.2266,361.5,1868.2266,365.5,1864.2266" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="85.5" x2="367.5" y1="1864.2266" y2="1864.2266"/><text fill="#FF0000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="54" x="92.5" y="1813.5527">prepare</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="4" x="146.5" y="1813.5527">:</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="184" x="124.5" y="1828.8633">- decrease counter #1 (value)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="179" x="124.5" y="1844.1738">- append event record (data)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="109" x="124.5" y="1859.4844">- release channel</text><polygon fill="#181818" points="96.5,1874.2266,86.5,1878.2266,96.5,1882.2266,92.5,1878.2266" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="90.5" x2="377.5" y1="1878.2266" y2="1878.2266"/><path d="M132,1891.2266 L132,1916.2266 L624,1916.2266 L624,1901.2266 L614,1891.2266 L132,1891.2266 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M614,1891.2266 L614,1901.2266 L624,1901.2266 L614,1891.2266 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="471" x="138" y="1908.7949">At the session closure, any data secure processing should be unnecessary.</text><polygon fill="#181818" points="361.5,1938.8477,371.5,1942.8477,361.5,1946.8477,365.5,1942.8477" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="85.5" x2="367.5" y1="1942.8477" y2="1942.8477"/><text fill="#FF0000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="52" x="92.5" y="1938.1055">process</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="128" x="148.5" y="1938.1055">closing (not ratified)</text><line style="stroke:#181818;stroke-width:1.0;" x1="383.5" x2="425.5" y1="1972.1582" y2="1972.1582"/><line style="stroke:#181818;stroke-width:1.0;" x1="425.5" x2="425.5" y1="1972.1582" y2="1985.1582"/><line style="stroke:#181818;stroke-width:1.0;" x1="384.5" x2="425.5" y1="1985.1582" y2="1985.1582"/><polygon fill="#181818" points="394.5,1981.1582,384.5,1985.1582,394.5,1989.1582,390.5,1985.1582" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="234" x="390.5" y="1967.416">anticipates the future card responses</text><polygon fill="#00FF00" points="981.5,2041.0898,991.5,2045.0898,981.5,2049.0898,985.5,2045.0898" style="stroke:#00FF00;stroke-width:1.0;"/><line style="stroke:#00FF00;stroke-width:1.0;" x1="383.5" x2="987.5" y1="2045.0898" y2="2045.0898"/><text fill="#008000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="51" x="390.5" y="2009.7266">SAM #3</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="135" x="390.5" y="2025.0371">transmit card request</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="71" x="422.5" y="2040.3477">- APDU list</text><path d="M937.5,2060.0898 L1209.5,2060.0898 L1209.5,2067.4004 L1199.5,2077.4004 L937.5,2077.4004 L937.5,2060.0898 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.5;"/><rect fill="none" height="103.9316" style="stroke:#000000;stroke-width:1.5;" width="429" x="937.5" y="2060.0898"/><text fill="#FF0000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="76" x="952.5" y="2073.6582">anticipated</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="147" x="1032.5" y="2073.6582">Card APDU responses</text><polygon fill="#181818" points="1308.5,2094.7109,1318.5,2098.7109,1308.5,2102.7109,1312.5,2098.7109" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="1003.5" x2="1314.5" y1="2098.7109" y2="2098.7109"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="205" x="1010.5" y="2093.9688">digest update (decrease counter)</text><polygon fill="#181818" points="1014.5,2108.7109,1004.5,2112.7109,1014.5,2116.7109,1010.5,2112.7109" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="1008.5" x2="1319.5" y1="2112.7109" y2="2112.7109"/><polygon fill="#181818" points="1308.5,2138.0215,1318.5,2142.0215,1308.5,2146.0215,1312.5,2142.0215" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="1003.5" x2="1314.5" y1="2142.0215" y2="2142.0215"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="226" x="1010.5" y="2137.2793">digest update (append event record)</text><polygon fill="#181818" points="1014.5,2152.0215,1004.5,2156.0215,1014.5,2160.0215,1010.5,2156.0215" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="1008.5" x2="1319.5" y1="2156.0215" y2="2156.0215"/><polygon fill="#181818" points="1308.5,2188.332,1318.5,2192.332,1308.5,2196.332,1312.5,2192.332" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="1003.5" x2="1314.5" y1="2192.332" y2="2192.332"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="76" x="1010.5" y="2187.5898">digest close</text><polygon fill="#181818" points="1014.5,2217.6426,1004.5,2221.6426,1014.5,2225.6426,1010.5,2221.6426" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="1008.5" x2="1319.5" y1="2221.6426" y2="2221.6426"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="102" x="1020.5" y="2216.9004">[SAM certificate]</text><polygon fill="#00FF00" points="394.5,2246.9531,384.5,2250.9531,394.5,2254.9531,390.5,2250.9531" style="stroke:#00FF00;stroke-width:1.0;"/><line style="stroke:#00FF00;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="388.5" x2="997.5" y1="2250.9531" y2="2250.9531"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="102" x="400.5" y="2246.2109">[SAM certificate]</text><polygon fill="#0000FF" points="619.5,2306.8848,629.5,2310.8848,619.5,2314.8848,623.5,2310.8848" style="stroke:#0000FF;stroke-width:1.0;"/><line style="stroke:#0000FF;stroke-width:1.0;" x1="383.5" x2="625.5" y1="2310.8848" y2="2310.8848"/><text fill="#0000FF" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="54" x="390.5" y="2275.5215">Card #3</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="135" x="390.5" y="2290.832">transmit card request</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="71" x="422.5" y="2306.1426">- APDU list</text><path d="M574,2325.8848 L870,2325.8848 L870,2333.1953 L860,2343.1953 L574,2343.1953 L574,2325.8848 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.5;"/><rect fill="none" height="119.2422" style="stroke:#000000;stroke-width:1.5;" width="373.5" x="574" y="2325.8848"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="251" x="589" y="2339.4531">Card APDU commands inside session</text><polygon fill="#181818" points="889.5,2360.5059,899.5,2364.5059,889.5,2368.5059,893.5,2364.5059" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="641.5" x2="895.5" y1="2364.5059" y2="2364.5059"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="168" x="648.5" y="2359.7637">update record (event, data)</text><polygon fill="#181818" points="652.5,2374.5059,642.5,2378.5059,652.5,2382.5059,648.5,2378.5059" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="646.5" x2="900.5" y1="2378.5059" y2="2378.5059"/><polygon fill="#181818" points="889.5,2403.8164,899.5,2407.8164,889.5,2411.8164,893.5,2407.8164" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="641.5" x2="895.5" y1="2407.8164" y2="2407.8164"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="228" x="648.5" y="2403.0742">decrease counter (counter #1, value)</text><polygon fill="#181818" points="652.5,2433.127,642.5,2437.127,652.5,2441.127,648.5,2437.127" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="646.5" x2="900.5" y1="2437.127" y2="2437.127"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="122" x="658.5" y="2432.3848">[new counter value]</text><polygon fill="#181818" points="889.5,2469.4375,899.5,2473.4375,889.5,2477.4375,893.5,2473.4375" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="641.5" x2="895.5" y1="2473.4375" y2="2473.4375"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="236" x="648.5" y="2468.6953">close secure session (SAM certificate)</text><polygon fill="#181818" points="652.5,2498.748,642.5,2502.748,652.5,2506.748,648.5,2502.748" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="646.5" x2="900.5" y1="2502.748" y2="2502.748"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="102" x="658.5" y="2498.0059">[card certificate]</text><polygon fill="#181818" points="889.5,2528.0586,899.5,2532.0586,889.5,2536.0586,893.5,2532.0586" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="641.5" x2="895.5" y1="2532.0586" y2="2532.0586"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="135" x="648.5" y="2527.3164">ratification command</text><polygon fill="#181818" points="652.5,2542.0586,642.5,2546.0586,652.5,2550.0586,648.5,2546.0586" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="646.5" x2="900.5" y1="2546.0586" y2="2546.0586"/><polygon fill="#181818" points="889.5,2571.3691,899.5,2575.3691,889.5,2579.3691,893.5,2575.3691" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="641.5" x2="895.5" y1="2575.3691" y2="2575.3691"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="117" x="648.5" y="2570.627">close card channel</text><polygon fill="#181818" points="652.5,2585.3691,642.5,2589.3691,652.5,2593.3691,648.5,2589.3691" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="646.5" x2="905.5" y1="2589.3691" y2="2589.3691"/><polygon fill="#0000FF" points="394.5,2614.6797,384.5,2618.6797,394.5,2622.6797,390.5,2618.6797" style="stroke:#0000FF;stroke-width:1.0;"/><line style="stroke:#0000FF;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="388.5" x2="635.5" y1="2618.6797" y2="2618.6797"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="102" x="400.5" y="2613.9375">[card certificate]</text><polygon fill="#00FF00" points="981.5,2674.6113,991.5,2678.6113,981.5,2682.6113,985.5,2678.6113" style="stroke:#00FF00;stroke-width:1.0;"/><line style="stroke:#00FF00;stroke-width:1.0;" x1="383.5" x2="987.5" y1="2678.6113" y2="2678.6113"/><text fill="#008000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="51" x="390.5" y="2643.248">SAM #4</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="135" x="390.5" y="2658.5586">transmit card request</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="71" x="422.5" y="2673.8691">- APDU list</text><polygon fill="#181818" points="1308.5,2703.9219,1318.5,2707.9219,1308.5,2711.9219,1312.5,2707.9219" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="1003.5" x2="1314.5" y1="2707.9219" y2="2707.9219"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="227" x="1010.5" y="2703.1797">digest authenticate (card certificate)</text><polygon fill="#181818" points="1014.5,2733.2324,1004.5,2737.2324,1014.5,2741.2324,1010.5,2737.2324" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="1008.5" x2="1319.5" y1="2737.2324" y2="2737.2324"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="142" x="1020.5" y="2732.4902">[authentication status]</text><polygon fill="#00FF00" points="394.5,2762.543,384.5,2766.543,394.5,2770.543,390.5,2766.543" style="stroke:#00FF00;stroke-width:1.0;"/><line style="stroke:#00FF00;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="388.5" x2="997.5" y1="2766.543" y2="2766.543"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="151" x="400.5" y="2761.8008">[authentification status]</text><polygon fill="#181818" points="96.5,2899.0273,86.5,2903.0273,96.5,2907.0273,92.5,2903.0273" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="90.5" x2="377.5" y1="2903.0273" y2="2903.0273"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="131" x="102.5" y="2791.1113">[Calypso card image:</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="127" x="134.5" y="2806.4219">- identification data</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="122" x="134.5" y="2821.7324">- environment data</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="119" x="134.5" y="2837.043">- contract list data</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="115" x="134.5" y="2852.3535">- contract #1 data</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="174" x="134.5" y="2867.6641">- counter #1 data (updated)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="133" x="134.5" y="2882.9746">- event #1 (updated)]</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="143" x="102.5" y="2898.2852">authentification status</text><!--MD5=[db964b78aeb90f49a39266618f465d26]
@startuml

'skinparam ClassBorderColor #F1C40F
skinparam ClassBorderColor #D4AC0D
skinparam stereotypeABorderColor #A9DCDF
skinparam stereotypeIBorderColor #B4A7E5
skinparam stereotypeCBorderColor #ADD1B2
skinparam stereotypeEBorderColor #EB93DF
skinparam shadowing false

skinparam StateBorderColor #D4AC0D
skinparam ActivityBorderColor #D4AC0D

' Red
skinparam ClassBackgroundColor<<red>> #FDEDEC
skinparam ClassBorderColor<<red>> #E74C3C
hide <<red>> stereotype
' Purple
skinparam ClassBackgroundColor<<purple>> #F4ECF7
skinparam ClassBorderColor<<purple>> #8E44AD
hide <<purple>> stereotype
' blue
skinparam ClassBackgroundColor<<blue>> #EBF5FB
skinparam ClassBorderColor<<blue>> #3498DB
hide <<blue>> stereotype
' Green
skinparam ClassBackgroundColor<<green>> #EAFAF1
skinparam ClassBorderColor<<green>> #2ECC71
hide <<green>> stereotype

' Orange
skinparam ClassBackgroundColor<<orange>> #FDF2E9
skinparam ClassBorderColor<<orange>> #E67E22
hide <<orange>> stereotype

' Grey
skinparam ClassBackgroundColor<<grey>> #EAECEE
skinparam ClassBorderColor<<grey>> #2C3E50
hide <<grey>> stereotype

actor "Ticketing Application" as app #gold
participant "Calypso API" as capi #pink
participant "Calypso Card\nReader" as cardReader #lightBlue
boundary "selected\n**Card**" as card #lightBlue
participant "Calypso SAM\nReader" as samReader #lightGreen
boundary "selected\n**SAM**" as sam #lightGreen

activate app #gold
activate card #lightBlue
activate sam #lightGreen

app->app: **instantiate** Calypso card transaction:\n\t- Calypso card resource\n\t- Calypso SAM resource

note over capi
    Checks a signature of previously read data when selecting the card.
end note

app->capi: <font color=red>**prepare**</font> card transaction:\n\t- read environment file\n\t- **verify** environment data **signature**\n\t- read contract #1\n\t- reader counter #1
activate capi  #pink
capi- ->app
deactivate capi

app->capi: <font color=red>**process**</font> opening (DEBIT access level)
activate capi  #pink

capi-[#00FF00]>samReader: <font color=green>**SAM #1**<font color=red>\ntransmit card request\n\t- APDU list
activate samReader #lightGreen
note over samReader
    A specific signature key diversification could be required before the signature processing.
end note

samReader->sam: **verify signature** (environment data signature)
sam- ->samReader: signature status

note over samReader
    A session key diversification is operated, if the diversifier is different than for the previous data secure processing operation.
end note

samReader->sam: select diversifier (card serial)
sam- ->samReader
samReader->sam: get challenge
sam- ->samReader: [SAM challenge]
samReader-[#00FF00]->capi: [environment data signature,\nSAM challenge]
deactivate samReader

capi-[#0000FF]>cardReader: <font color=blue>**Card #2**</font>\ntransmit card request\n\t- APDU list
activate cardReader #lightBlue

group Card APDU commands inside session
    cardReader->card: open secure session (card debit key,\n\tSAM challenge,\n\tSFI environment to read)
    card- ->cardReader: [card challenge & environment data]
    cardReader->card: read record (contract #1)
    card- ->cardReader: [contract #1 data]
    cardReader->card: read record (counter #1)
    card- ->cardReader: [counter #1 data]
end

cardReader- -[#0000FF]>capi: [card challenge]
deactivate cardReader

capi- ->app: [Calypso card image:\n\t- identification data\n\t- environment data (updated)\n\t- contract list data\n\t- contract #1 data\n\t- counter #1 data]\n[Data secure processing:\n\t- environment data signature status]
deactivate capi

app->capi: <font color=red>**prepare**</font> secured card transaction:\n\t- **verify** contract #1 data **signature**\n\t- **compute** event data **signature**
activate capi  #pink
capi- ->app
deactivate capi

app->capi: <font color=red>**process**</font> commands
activate capi  #pink

capi-[#00FF00]>samReader: <font color=green>**SAM #2**<font color=red>\ntransmit card request\n\t- APDU list
activate samReader #lightGreen

note over samReader
    When data secure processing requested, processes all pending SAM commands.
end note

samReader->sam: digest init (opening data)
sam- ->samReader
samReader->sam: digest update (read environment)
sam- ->samReader
samReader->sam: digest update (read contract)
sam- ->samReader
samReader->sam: digest update (read counter)
sam- ->samReader

note over samReader
    If necessary, a specific contract signature key diversification could be operated before the signature processing.
end note

samReader->sam: **verify signature** (contract #1 data signature)
sam- ->samReader: signature status

note over samReader
    If necessary, a specific event signature key diversification could be operated before the signature processing.
end note

samReader->sam: **compute signature** (event data)
sam- ->samReader: event data signature

samReader-[#00FF00]->capi: [contract #1 data signature status,\nevent data signature]
deactivate samReader

capi- ->app: [Data secure processing:\n\t- contract #1 data signature status\n\t- event data signature]
deactivate capi


app->capi: <font color=red>**prepare**</font>:\n\t- decrease counter #1 (value)\n\t- append event record (data)\n\t- release channel
activate capi  #pink
capi- ->app
deactivate capi

note over capi
    At the session closure, any data secure processing should be unnecessary.
end note

app->capi: <font color=red>**process**</font> closing (not ratified)
activate capi  #pink
capi->capi: anticipates the future card responses

capi-[#00FF00]>samReader: <font color=green>**SAM #3**</font>\ntransmit card request\n\t- APDU list
activate samReader #lightGreen

group <font color=red>**anticipated**</font> Card APDU responses
    samReader->sam: digest update (decrease counter)
    sam- ->samReader
    samReader->sam: digest update (append event record)
    sam- ->samReader
end
samReader->sam: digest close
sam- ->samReader: [SAM certificate]

samReader-[#00FF00]->capi: [SAM certificate]
deactivate samReader

capi-[#0000FF]>cardReader: <font color=blue>**Card #3**</font>\ntransmit card request\n\t- APDU list
activate cardReader #lightBlue

group Card APDU commands inside session
    cardReader->card: update record (event, data)
    card- ->cardReader
    cardReader->card: decrease counter (counter #1, value)
    card- ->cardReader: [new counter value]
end

cardReader->card: close secure session (SAM certificate)
card- ->cardReader: [card certificate]
cardReader->card: ratification command
card- ->cardReader
cardReader->card: close card channel
card- ->cardReader
deactivate card

cardReader-[#0000FF]->capi: [card certificate]
deactivate cardReader

capi-[#00FF00]>samReader: <font color=green>**SAM #4**</font>\ntransmit card request\n\t- APDU list
activate samReader #lightGreen
samReader->sam: digest authenticate (card certificate)
sam- ->samReader: [authentication status]

samReader-[#00FF00]->capi: [authentification status]
deactivate samReader

capi- ->app: [Calypso card image:\n\t- identification data\n\t- environment data\n\t- contract list data\n\t- contract #1 data\n\t- counter #1 data (updated)\n\t- event #1 (updated)]\nauthentification status
deactivate capi
@enduml

@startuml

skinparam ClassBorderColor #D4AC0D
skinparam stereotypeABorderColor #A9DCDF
skinparam stereotypeIBorderColor #B4A7E5
skinparam stereotypeCBorderColor #ADD1B2
skinparam stereotypeEBorderColor #EB93DF
skinparam shadowing false

skinparam StateBorderColor #D4AC0D
skinparam ActivityBorderColor #D4AC0D

skinparam ClassBackgroundColor<<red>> #FDEDEC
skinparam ClassBorderColor<<red>> #E74C3C
hide <<red>> stereotype
skinparam ClassBackgroundColor<<purple>> #F4ECF7
skinparam ClassBorderColor<<purple>> #8E44AD
hide <<purple>> stereotype
skinparam ClassBackgroundColor<<blue>> #EBF5FB
skinparam ClassBorderColor<<blue>> #3498DB
hide <<blue>> stereotype
skinparam ClassBackgroundColor<<green>> #EAFAF1
skinparam ClassBorderColor<<green>> #2ECC71
hide <<green>> stereotype

skinparam ClassBackgroundColor<<orange>> #FDF2E9
skinparam ClassBorderColor<<orange>> #E67E22
hide <<orange>> stereotype

skinparam ClassBackgroundColor<<grey>> #EAECEE
skinparam ClassBorderColor<<grey>> #2C3E50
hide <<grey>> stereotype

actor "Ticketing Application" as app #gold
participant "Calypso API" as capi #pink
participant "Calypso Card\nReader" as cardReader #lightBlue
boundary "selected\n**Card**" as card #lightBlue
participant "Calypso SAM\nReader" as samReader #lightGreen
boundary "selected\n**SAM**" as sam #lightGreen

activate app #gold
activate card #lightBlue
activate sam #lightGreen

app->app: **instantiate** Calypso card transaction:\n\t- Calypso card resource\n\t- Calypso SAM resource

note over capi
    Checks a signature of previously read data when selecting the card.
end note

app->capi: <font color=red>**prepare**</font> card transaction:\n\t- read environment file\n\t- **verify** environment data **signature**\n\t- read contract #1\n\t- reader counter #1
activate capi  #pink
capi- ->app
deactivate capi

app->capi: <font color=red>**process**</font> opening (DEBIT access level)
activate capi  #pink

capi-[#00FF00]>samReader: <font color=green>**SAM #1**<font color=red>\ntransmit card request\n\t- APDU list
activate samReader #lightGreen
note over samReader
    A specific signature key diversification could be required before the signature processing.
end note

samReader->sam: **verify signature** (environment data signature)
sam- ->samReader: signature status

note over samReader
    A session key diversification is operated, if the diversifier is different than for the previous data secure processing operation.
end note

samReader->sam: select diversifier (card serial)
sam- ->samReader
samReader->sam: get challenge
sam- ->samReader: [SAM challenge]
samReader-[#00FF00]->capi: [environment data signature,\nSAM challenge]
deactivate samReader

capi-[#0000FF]>cardReader: <font color=blue>**Card #2**</font>\ntransmit card request\n\t- APDU list
activate cardReader #lightBlue

group Card APDU commands inside session
    cardReader->card: open secure session (card debit key,\n\tSAM challenge,\n\tSFI environment to read)
    card- ->cardReader: [card challenge & environment data]
    cardReader->card: read record (contract #1)
    card- ->cardReader: [contract #1 data]
    cardReader->card: read record (counter #1)
    card- ->cardReader: [counter #1 data]
end

cardReader- -[#0000FF]>capi: [card challenge]
deactivate cardReader

capi- ->app: [Calypso card image:\n\t- identification data\n\t- environment data (updated)\n\t- contract list data\n\t- contract #1 data\n\t- counter #1 data]\n[Data secure processing:\n\t- environment data signature status]
deactivate capi

app->capi: <font color=red>**prepare**</font> secured card transaction:\n\t- **verify** contract #1 data **signature**\n\t- **compute** event data **signature**
activate capi  #pink
capi- ->app
deactivate capi

app->capi: <font color=red>**process**</font> commands
activate capi  #pink

capi-[#00FF00]>samReader: <font color=green>**SAM #2**<font color=red>\ntransmit card request\n\t- APDU list
activate samReader #lightGreen

note over samReader
    When data secure processing requested, processes all pending SAM commands.
end note

samReader->sam: digest init (opening data)
sam- ->samReader
samReader->sam: digest update (read environment)
sam- ->samReader
samReader->sam: digest update (read contract)
sam- ->samReader
samReader->sam: digest update (read counter)
sam- ->samReader

note over samReader
    If necessary, a specific contract signature key diversification could be operated before the signature processing.
end note

samReader->sam: **verify signature** (contract #1 data signature)
sam- ->samReader: signature status

note over samReader
    If necessary, a specific event signature key diversification could be operated before the signature processing.
end note

samReader->sam: **compute signature** (event data)
sam- ->samReader: event data signature

samReader-[#00FF00]->capi: [contract #1 data signature status,\nevent data signature]
deactivate samReader

capi- ->app: [Data secure processing:\n\t- contract #1 data signature status\n\t- event data signature]
deactivate capi


app->capi: <font color=red>**prepare**</font>:\n\t- decrease counter #1 (value)\n\t- append event record (data)\n\t- release channel
activate capi  #pink
capi- ->app
deactivate capi

note over capi
    At the session closure, any data secure processing should be unnecessary.
end note

app->capi: <font color=red>**process**</font> closing (not ratified)
activate capi  #pink
capi->capi: anticipates the future card responses

capi-[#00FF00]>samReader: <font color=green>**SAM #3**</font>\ntransmit card request\n\t- APDU list
activate samReader #lightGreen

group <font color=red>**anticipated**</font> Card APDU responses
    samReader->sam: digest update (decrease counter)
    sam- ->samReader
    samReader->sam: digest update (append event record)
    sam- ->samReader
end
samReader->sam: digest close
sam- ->samReader: [SAM certificate]

samReader-[#00FF00]->capi: [SAM certificate]
deactivate samReader

capi-[#0000FF]>cardReader: <font color=blue>**Card #3**</font>\ntransmit card request\n\t- APDU list
activate cardReader #lightBlue

group Card APDU commands inside session
    cardReader->card: update record (event, data)
    card- ->cardReader
    cardReader->card: decrease counter (counter #1, value)
    card- ->cardReader: [new counter value]
end

cardReader->card: close secure session (SAM certificate)
card- ->cardReader: [card certificate]
cardReader->card: ratification command
card- ->cardReader
cardReader->card: close card channel
card- ->cardReader
deactivate card

cardReader-[#0000FF]->capi: [card certificate]
deactivate cardReader

capi-[#00FF00]>samReader: <font color=green>**SAM #4**</font>\ntransmit card request\n\t- APDU list
activate samReader #lightGreen
samReader->sam: digest authenticate (card certificate)
sam- ->samReader: [authentication status]

samReader-[#00FF00]->capi: [authentification status]
deactivate samReader

capi- ->app: [Calypso card image:\n\t- identification data\n\t- environment data\n\t- contract list data\n\t- contract #1 data\n\t- counter #1 data (updated)\n\t- event #1 (updated)]\nauthentification status
deactivate capi
@enduml

PlantUML version 1.2022.4(Sat Apr 09 17:29:17 RET 2022)
(GPL source distribution)
Java Runtime: OpenJDK Runtime Environment
JVM: OpenJDK 64-Bit Server VM
Default Encoding: UTF-8
Language: fr
Country: FR
--></g></svg>
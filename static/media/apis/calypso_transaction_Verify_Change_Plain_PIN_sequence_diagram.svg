<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentStyleType="text/css" height="953px" preserveAspectRatio="none" style="width:767px;height:953px;background:#FFFFFF;" version="1.1" viewBox="0 0 767 953" width="767px" zoomAndPan="magnify"><defs/><g><rect fill="#FFD700" height="772.0059" style="stroke:#181818;stroke-width:1.0;" width="10" x="75.5" y="91.4883"/><rect fill="#FFC0CB" height="44.6211" style="stroke:#181818;stroke-width:1.0;" width="10" x="381.5" y="112.7988"/><rect fill="#FFC0CB" height="207.7949" style="stroke:#181818;stroke-width:1.0;" width="10" x="381.5" y="287.6621"/><rect fill="#FFC0CB" height="14" style="stroke:#181818;stroke-width:1.0;" width="10" x="381.5" y="560.0781"/><rect fill="#FFC0CB" height="251.1055" style="stroke:#181818;stroke-width:1.0;" width="10" x="381.5" y="603.3887"/><rect fill="#ADD8E6" height="87.9316" style="stroke:#181818;stroke-width:1.0;" width="10" x="545.5" y="347.5938"/><rect fill="#ADD8E6" height="131.2422" style="stroke:#181818;stroke-width:1.0;" width="10" x="545.5" y="663.3203"/><rect fill="#ADD8E6" height="673.7637" style="stroke:#181818;stroke-width:1.0;" width="10" x="719.5" y="91.4883"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="80" x2="80" y1="81.4883" y2="872.4941"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="386.5" x2="386.5" y1="81.4883" y2="872.4941"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="550" x2="550" y1="81.4883" y2="872.4941"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="724.5" x2="724.5" y1="81.4883" y2="872.4941"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="145" x="5" y="78.5352">Ticketing Application</text><ellipse cx="80.5" cy="13.5" fill="#FFD700" rx="8" ry="8" style="stroke:#181818;stroke-width:0.5;"/><path d="M80.5,21.5 L80.5,48.5 M67.5,29.5 L93.5,29.5 M80.5,48.5 L67.5,63.5 M80.5,48.5 L93.5,63.5 " fill="none" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="145" x="5" y="885.0293">Ticketing Application</text><ellipse cx="80.5" cy="896.4824" fill="#FFD700" rx="8" ry="8" style="stroke:#181818;stroke-width:0.5;"/><path d="M80.5,904.4824 L80.5,931.4824 M67.5,912.4824 L93.5,912.4824 M80.5,931.4824 L67.5,946.4824 M80.5,931.4824 L93.5,946.4824 " fill="none" style="stroke:#181818;stroke-width:0.5;"/><rect fill="#FFC0CB" height="30.4883" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="94" x="339.5" y="50"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="80" x="346.5" y="70.5352">Calypso API</text><rect fill="#FFC0CB" height="30.4883" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="94" x="339.5" y="871.4941"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="80" x="346.5" y="892.0293">Calypso API</text><rect fill="#ADD8E6" height="46.9766" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="105" x="498" y="33.5117"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="91" x="505" y="54.0469">Calypso Card</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="48" x="526.5" y="70.5352">Reader</text><rect fill="#ADD8E6" height="46.9766" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="105" x="498" y="871.4941"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="91" x="505" y="892.0293">Calypso Card</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="48" x="526.5" y="908.5176">Reader</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="56" x="693.5" y="62.0469">selected</text><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="33" x="705" y="78.5352">Card</text><path d="M704,20.5117 L704,44.5117 M704,32.5117 L721,32.5117 " fill="none" style="stroke:#181818;stroke-width:0.5;"/><ellipse cx="733" cy="32.5117" fill="#ADD8E6" rx="12" ry="12" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="56" x="693.5" y="885.0293">selected</text><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="33" x="705" y="901.5176">Card</text><path d="M704,908.4707 L704,932.4707 M704,920.4707 L721,920.4707 " fill="none" style="stroke:#181818;stroke-width:0.5;"/><ellipse cx="733" cy="920.4707" fill="#ADD8E6" rx="12" ry="12" style="stroke:#181818;stroke-width:0.5;"/><rect fill="#FFD700" height="772.0059" style="stroke:#181818;stroke-width:1.0;" width="10" x="75.5" y="91.4883"/><rect fill="#FFC0CB" height="44.6211" style="stroke:#181818;stroke-width:1.0;" width="10" x="381.5" y="112.7988"/><rect fill="#FFC0CB" height="207.7949" style="stroke:#181818;stroke-width:1.0;" width="10" x="381.5" y="287.6621"/><rect fill="#FFC0CB" height="14" style="stroke:#181818;stroke-width:1.0;" width="10" x="381.5" y="560.0781"/><rect fill="#FFC0CB" height="251.1055" style="stroke:#181818;stroke-width:1.0;" width="10" x="381.5" y="603.3887"/><rect fill="#ADD8E6" height="87.9316" style="stroke:#181818;stroke-width:1.0;" width="10" x="545.5" y="347.5938"/><rect fill="#ADD8E6" height="131.2422" style="stroke:#181818;stroke-width:1.0;" width="10" x="545.5" y="663.3203"/><rect fill="#ADD8E6" height="673.7637" style="stroke:#181818;stroke-width:1.0;" width="10" x="719.5" y="91.4883"/><polygon fill="#181818" points="369.5,108.7988,379.5,112.7988,369.5,116.7988,373.5,112.7988" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="85.5" x2="375.5" y1="112.7988" y2="112.7988"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="27" x="92.5" y="108.0566">cast</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="81" x="123.5" y="108.0566">Calypso card</text><polygon fill="#181818" points="96.5,153.4199,86.5,157.4199,96.5,161.4199,92.5,157.4199" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="90.5" x2="385.5" y1="157.4199" y2="157.4199"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="131" x="102.5" y="137.3672">[Calypso card image:</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="240" x="134.5" y="152.6777">- identification data with PIN support]</text><rect fill="#EEEEEE" height="3" style="stroke:#EEEEEE;stroke-width:1.0;" width="760.5" x="0" y="186.0752"/><line style="stroke:#000000;stroke-width:1.0;" x1="0" x2="760.5" y1="186.0752" y2="186.0752"/><line style="stroke:#000000;stroke-width:1.0;" x1="0" x2="760.5" y1="189.0752" y2="189.0752"/><rect fill="#EEEEEE" height="23.3105" style="stroke:#000000;stroke-width:2.0;" width="179" x="290.75" y="175.4199"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="161" x="296.75" y="191.9883">Card secure transaction</text><line style="stroke:#181818;stroke-width:1.0;" x1="85.5" x2="127.5" y1="245.3516" y2="245.3516"/><line style="stroke:#181818;stroke-width:1.0;" x1="127.5" x2="127.5" y1="245.3516" y2="258.3516"/><line style="stroke:#181818;stroke-width:1.0;" x1="86.5" x2="127.5" y1="258.3516" y2="258.3516"/><polygon fill="#181818" points="96.5,254.3516,86.5,258.3516,96.5,262.3516,92.5,258.3516" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="72" x="92.5" y="225.2988">instantiate</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="160" x="168.5" y="225.2988">Calypso card transaction:</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="151" x="124.5" y="240.6094">- Calypso card resource</text><polygon fill="#181818" points="369.5,283.6621,379.5,287.6621,369.5,291.6621,373.5,287.6621" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="85.5" x2="375.5" y1="287.6621" y2="287.6621"/><text fill="#FF0000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="52" x="92.5" y="282.9199">process</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="143" x="148.5" y="282.9199">Verify PIN (current PIN)</text><polygon fill="#0000FF" points="533.5,343.5938,543.5,347.5938,533.5,351.5938,537.5,347.5938" style="stroke:#0000FF;stroke-width:1.0;"/><line style="stroke:#0000FF;stroke-width:1.0;" x1="391.5" x2="539.5" y1="347.5938" y2="347.5938"/><text fill="#0000FF" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="54" x="398.5" y="312.2305">Card #2</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="135" x="398.5" y="327.541">transmit card request</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="71" x="430.5" y="342.8516">- APDU list</text><polygon fill="#181818" points="707.5,372.9043,717.5,376.9043,707.5,380.9043,711.5,376.9043" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="555.5" x2="713.5" y1="376.9043" y2="376.9043"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="129" x="562.5" y="372.1621">Verify PIN (plain PIN)</text><polygon fill="#181818" points="566.5,402.2148,556.5,406.2148,566.5,410.2148,562.5,406.2148" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="560.5" x2="718.5" y1="406.2148" y2="406.2148"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="72" x="572.5" y="401.4727">[PIN status]</text><polygon fill="#0000FF" points="402.5,431.5254,392.5,435.5254,402.5,439.5254,398.5,435.5254" style="stroke:#0000FF;stroke-width:1.0;"/><line style="stroke:#0000FF;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="396.5" x2="549.5" y1="435.5254" y2="435.5254"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="72" x="408.5" y="430.7832">[PIN status]</text><polygon fill="#181818" points="96.5,491.457,86.5,495.457,96.5,499.457,92.5,495.457" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="90.5" x2="385.5" y1="495.457" y2="495.457"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="131" x="102.5" y="460.0938">[Calypso card image:</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="236" x="134.5" y="475.4043">- identification data with PIN support</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="80" x="134.5" y="490.7148">- PIN status]</text><path d="M182,508.457 L182,533.457 L590,533.457 L590,518.457 L580,508.457 L182,508.457 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M580,508.457 L580,518.457 L590,518.457 L580,508.457 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="387" x="188" y="526.0254">The PIN could updated in plain after a successful verification.</text><polygon fill="#181818" points="369.5,556.0781,379.5,560.0781,369.5,564.0781,373.5,560.0781" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="85.5" x2="375.5" y1="560.0781" y2="560.0781"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="152" x="92.5" y="555.3359">prepare: release channel</text><polygon fill="#181818" points="96.5,570.0781,86.5,574.0781,96.5,578.0781,92.5,574.0781" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="90.5" x2="385.5" y1="574.0781" y2="574.0781"/><polygon fill="#181818" points="369.5,599.3887,379.5,603.3887,369.5,607.3887,373.5,603.3887" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="85.5" x2="375.5" y1="603.3887" y2="603.3887"/><text fill="#FF0000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="52" x="92.5" y="598.6465">process</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="134" x="148.5" y="598.6465">Change PIN (new PIN)</text><polygon fill="#0000FF" points="533.5,659.3203,543.5,663.3203,533.5,667.3203,537.5,663.3203" style="stroke:#0000FF;stroke-width:1.0;"/><line style="stroke:#0000FF;stroke-width:1.0;" x1="391.5" x2="539.5" y1="663.3203" y2="663.3203"/><text fill="#0000FF" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="54" x="398.5" y="627.957">Card #3</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="135" x="398.5" y="643.2676">transmit card request</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="71" x="430.5" y="658.5781">- APDU list</text><polygon fill="#181818" points="707.5,688.6309,717.5,692.6309,707.5,696.6309,711.5,692.6309" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="555.5" x2="713.5" y1="692.6309" y2="692.6309"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="140" x="562.5" y="687.8887">Change PIN (plain PIN)</text><polygon fill="#181818" points="566.5,717.9414,556.5,721.9414,566.5,725.9414,562.5,721.9414" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="560.5" x2="718.5" y1="721.9414" y2="721.9414"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="22" x="572.5" y="717.1992">ack</text><polygon fill="#181818" points="707.5,747.252,717.5,751.252,707.5,755.252,711.5,751.252" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="555.5" x2="713.5" y1="751.252" y2="751.252"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="117" x="562.5" y="746.5098">close card channel</text><polygon fill="#181818" points="566.5,761.252,556.5,765.252,566.5,769.252,562.5,765.252" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="560.5" x2="723.5" y1="765.252" y2="765.252"/><polygon fill="#0000FF" points="402.5,790.5625,392.5,794.5625,402.5,798.5625,398.5,794.5625" style="stroke:#0000FF;stroke-width:1.0;"/><line style="stroke:#0000FF;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="396.5" x2="549.5" y1="794.5625" y2="794.5625"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="22" x="408.5" y="789.8203">ack</text><polygon fill="#181818" points="96.5,850.4941,86.5,854.4941,96.5,858.4941,92.5,854.4941" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="90.5" x2="385.5" y1="854.4941" y2="854.4941"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="131" x="102.5" y="819.1309">[Calypso card image:</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="236" x="134.5" y="834.4414">- identification data with PIN support</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="80" x="134.5" y="849.752">- PIN status]</text><!--MD5=[29690919a9e26249ddae7d570d8c26d3]
@startuml

'skinparam ClassBorderColor #F1C40F
skinparam ClassBorderColor #D4AC0D
skinparam stereotypeABorderColor #A9DCDF
skinparam stereotypeIBorderColor #B4A7E5
skinparam stereotypeCBorderColor #ADD1B2
skinparam stereotypeEBorderColor #EB93DF
skinparam shadowing false

skinparam StateBorderColor #D4AC0D
skinparam ActivityBorderColor #D4AC0D

' Red
skinparam ClassBackgroundColor<<red>> #FDEDEC
skinparam ClassBorderColor<<red>> #E74C3C
hide <<red>> stereotype
' Purple
skinparam ClassBackgroundColor<<purple>> #F4ECF7
skinparam ClassBorderColor<<purple>> #8E44AD
hide <<purple>> stereotype
' blue
skinparam ClassBackgroundColor<<blue>> #EBF5FB
skinparam ClassBorderColor<<blue>> #3498DB
hide <<blue>> stereotype
' Green
skinparam ClassBackgroundColor<<green>> #EAFAF1
skinparam ClassBorderColor<<green>> #2ECC71
hide <<green>> stereotype

' Orange
skinparam ClassBackgroundColor<<orange>> #FDF2E9
skinparam ClassBorderColor<<orange>> #E67E22
hide <<orange>> stereotype

' Grey
skinparam ClassBackgroundColor<<grey>> #EAECEE
skinparam ClassBorderColor<<grey>> #2C3E50
hide <<grey>> stereotype

actor "Ticketing Application" as app #gold
participant "Calypso API" as capi #pink
participant "Calypso Card\nReader" as cardReader #lightBlue
boundary "selected\n**Card**" as card #lightBlue

activate app #gold

activate card #lightBlue

app->capi: **cast** Calypso card
activate capi  #pink
capi- ->app: [Calypso card image:\n\t- identification data with PIN support]

deactivate capi

== Card secure transaction ==

app->app: **instantiate** Calypso card transaction:\n\t- Calypso card resource


app->capi: <font color=red>**process**</font> Verify PIN (current PIN)
activate capi  #pink

capi-[#0000FF]>cardReader: <font color=blue>**Card #2**</font>\ntransmit card request\n\t- APDU list
activate cardReader #lightBlue

'group Card APDU commands inside session
    cardReader->card: Verify PIN (plain PIN)
    card- ->cardReader: [PIN status]
'end

cardReader-[#0000FF]->capi: [PIN status]
deactivate cardReader

capi- ->app: [Calypso card image:\n\t- identification data with PIN support\n\t- PIN status]
deactivate capi

note over capi
    The PIN could updated in plain after a successful verification.
end note

app->capi: prepare: release channel
activate capi  #pink
capi- ->app
deactivate capi

app->capi: <font color=red>**process**</font> Change PIN (new PIN)
activate capi  #pink

capi-[#0000FF]>cardReader: <font color=blue>**Card #3**</font>\ntransmit card request\n\t- APDU list
activate cardReader #lightBlue

'group Card APDU commands inside session
    cardReader->card: Change PIN (plain PIN)
    card- ->cardReader: ack
    cardReader->card: close card channel
    card- ->cardReader
'end
deactivate card

cardReader-[#0000FF]->capi: ack
deactivate cardReader

capi- ->app: [Calypso card image:\n\t- identification data with PIN support\n\t- PIN status]
deactivate capi

deactivate capi
@enduml

@startuml

skinparam ClassBorderColor #D4AC0D
skinparam stereotypeABorderColor #A9DCDF
skinparam stereotypeIBorderColor #B4A7E5
skinparam stereotypeCBorderColor #ADD1B2
skinparam stereotypeEBorderColor #EB93DF
skinparam shadowing false

skinparam StateBorderColor #D4AC0D
skinparam ActivityBorderColor #D4AC0D

skinparam ClassBackgroundColor<<red>> #FDEDEC
skinparam ClassBorderColor<<red>> #E74C3C
hide <<red>> stereotype
skinparam ClassBackgroundColor<<purple>> #F4ECF7
skinparam ClassBorderColor<<purple>> #8E44AD
hide <<purple>> stereotype
skinparam ClassBackgroundColor<<blue>> #EBF5FB
skinparam ClassBorderColor<<blue>> #3498DB
hide <<blue>> stereotype
skinparam ClassBackgroundColor<<green>> #EAFAF1
skinparam ClassBorderColor<<green>> #2ECC71
hide <<green>> stereotype

skinparam ClassBackgroundColor<<orange>> #FDF2E9
skinparam ClassBorderColor<<orange>> #E67E22
hide <<orange>> stereotype

skinparam ClassBackgroundColor<<grey>> #EAECEE
skinparam ClassBorderColor<<grey>> #2C3E50
hide <<grey>> stereotype

actor "Ticketing Application" as app #gold
participant "Calypso API" as capi #pink
participant "Calypso Card\nReader" as cardReader #lightBlue
boundary "selected\n**Card**" as card #lightBlue

activate app #gold

activate card #lightBlue

app->capi: **cast** Calypso card
activate capi  #pink
capi- ->app: [Calypso card image:\n\t- identification data with PIN support]

deactivate capi

== Card secure transaction ==

app->app: **instantiate** Calypso card transaction:\n\t- Calypso card resource


app->capi: <font color=red>**process**</font> Verify PIN (current PIN)
activate capi  #pink

capi-[#0000FF]>cardReader: <font color=blue>**Card #2**</font>\ntransmit card request\n\t- APDU list
activate cardReader #lightBlue

    cardReader->card: Verify PIN (plain PIN)
    card- ->cardReader: [PIN status]

cardReader-[#0000FF]->capi: [PIN status]
deactivate cardReader

capi- ->app: [Calypso card image:\n\t- identification data with PIN support\n\t- PIN status]
deactivate capi

note over capi
    The PIN could updated in plain after a successful verification.
end note

app->capi: prepare: release channel
activate capi  #pink
capi- ->app
deactivate capi

app->capi: <font color=red>**process**</font> Change PIN (new PIN)
activate capi  #pink

capi-[#0000FF]>cardReader: <font color=blue>**Card #3**</font>\ntransmit card request\n\t- APDU list
activate cardReader #lightBlue

    cardReader->card: Change PIN (plain PIN)
    card- ->cardReader: ack
    cardReader->card: close card channel
    card- ->cardReader
deactivate card

cardReader-[#0000FF]->capi: ack
deactivate cardReader

capi- ->app: [Calypso card image:\n\t- identification data with PIN support\n\t- PIN status]
deactivate capi

deactivate capi
@enduml

PlantUML version 1.2022.4(Sat Apr 09 17:29:17 RET 2022)
(GPL source distribution)
Java Runtime: OpenJDK Runtime Environment
JVM: OpenJDK 64-Bit Server VM
Default Encoding: UTF-8
Language: fr
Country: FR
--></g></svg>
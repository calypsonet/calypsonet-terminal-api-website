<!doctype html><html lang=en-us><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=generator content="Hugo Blox Builder 5.9.6"><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link rel=preload as=style href="https://fonts.googleapis.com/css2?family=Montserrat&display=swap"><link rel=stylesheet href="https://fonts.googleapis.com/css2?family=Montserrat&display=swap" media=print onload='this.media="all"'><link rel=stylesheet href=../../../css/vendor-bundle.min.047268c6dd09ad74ba54a0ba71837064.css media=print onload='this.media="all"'><link rel=stylesheet href=https://cdn.jsdelivr.net/gh/jpswalsh/academicons@1.9.4/css/academicons.min.css integrity="sha512-IW0nhlW5MgNydsXJO40En2EoCkTTjZhI3yuODrZIc8cQ4h1XcF53PsqDHa09NqnkXuIe0Oiyyj171BqZFwISBw==" crossorigin=anonymous media=print onload='this.media="all"'><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/leaflet@1.7.1/dist/leaflet.min.css integrity crossorigin=anonymous media=print onload='this.media="all"'><link rel=stylesheet href=../../../css/wowchemy.7115af9453c09d1fba56180e72fdc07e.css><link rel=stylesheet href=../../../css/libs/chroma/github-dark.min.css title=hl-light media=print onload='this.media="all"'><link rel=stylesheet href=../../../css/libs/chroma/github-dark.min.css title=hl-dark media=print onload='this.media="all"' disabled><meta name=description content="Public high-level API which standardizes the way to interact with a CalypsoÂ® product (card, NFC smartphone applet/application, SAM, etc...)."><link rel=alternate hreflang=en-us href=https://terminal-api.calypsonet.org/specifications/calypso-layer/calypso-card-api/><link rel=canonical href=https://terminal-api.calypsonet.org/specifications/calypso-layer/calypso-card-api/><link rel=manifest href=../../../manifest.webmanifest><link rel=icon type=image/png href=../../../media/icon_huceb5ed780c823eaac47da25fabbbc8be_2207_32x32_fill_lanczos_center_3.png><link rel=apple-touch-icon type=image/png href=../../../media/icon_huceb5ed780c823eaac47da25fabbbc8be_2207_180x180_fill_lanczos_center_3.png><meta name=theme-color content="#039efd"><meta property="twitter:card" content="summary"><meta property="twitter:image" content="https://terminal-api.calypsonet.org/media/logo.svg"><meta property="og:type" content="article"><meta property="og:site_name" content="Smartcard-based Ticketing Terminal APIs by the Calypso Networks Association"><meta property="og:url" content="https://terminal-api.calypsonet.org/specifications/calypso-layer/calypso-card-api/"><meta property="og:title" content="Calypso Card API (external) | Smartcard-based Ticketing Terminal APIs by the Calypso Networks Association"><meta property="og:description" content="Public high-level API which standardizes the way to interact with a CalypsoÂ® product (card, NFC smartphone applet/application, SAM, etc...)."><meta property="og:image" content="https://terminal-api.calypsonet.org/media/logo.svg"><meta property="og:locale" content="en-us"><meta property="article:modified_time" content="2024-10-31T20:09:48+04:00"><title>Calypso Card API (external) | Smartcard-based Ticketing Terminal APIs by the Calypso Networks Association</title></head><body id=top data-spy=scroll data-offset=70 data-target=#TableOfContents class=page-wrapper data-wc-page-id=6ad7cc20aaf4cc03812350271d69b202><script src=../../../js/wowchemy-init.min.d66af272089c6c0601f1a57edc3bf6ab.js></script><aside class=search-modal id=search><div class=container><section class=search-header><div class="row no-gutters justify-content-between mb-3"><div class=col-6><h1>Search</h1></div><div class="col-6 col-search-close"><a class=js-search href=# aria-label=Close><i class="fas fa-times-circle text-muted" aria-hidden=true></i></a></div></div><div id=search-box><input name=q id=search-query placeholder=Search... autocapitalize=off autocomplete=off autocorrect=off spellcheck=false type=search class=form-control aria-label=Search...></div></section><section class=section-search-results><div id=search-hits></div></section></div></aside><div class="page-header header--fixed"><header><nav class="navbar navbar-expand-lg navbar-light compensate-for-scrollbar" id=navbar-main><div class=container-xl><div class="d-none d-lg-inline-flex"><a class=navbar-brand href=../../../><img src=../../../media/logo.svg alt="Smartcard-based Ticketing Terminal APIs by the Calypso Networks Association"></a></div><button type=button class=navbar-toggler data-toggle=collapse data-target=#navbar-content aria-controls=navbar-content aria-expanded=false aria-label="Toggle navigation">
<span><i class="fas fa-bars"></i></span></button><div class="navbar-brand-mobile-wrapper d-inline-flex d-lg-none"><a class=navbar-brand href=../../../><img src=../../../media/logo.svg alt="Smartcard-based Ticketing Terminal APIs by the Calypso Networks Association"></a></div><div class="navbar-collapse main-menu-item collapse justify-content-end" id=navbar-content><ul class="navbar-nav d-md-inline-flex"><li class=nav-item><a class="nav-link active" href=../../../specifications/><span>Specifications</span></a></li><li class="nav-item dropdown"><a href=# class="nav-link dropdown-toggle" data-toggle=dropdown aria-haspopup=true><span>Community</span><span class=caret></span></a><div class=dropdown-menu><a class=dropdown-item href=../../../community/contributing/><span>Contributing</span></a>
<a class=dropdown-item href=../../../community/roadmap/><span>Roadmap</span></a>
<a class=dropdown-item href=../../../project-dashboard/><span>Project dashboard</span></a>
<a class=dropdown-item href=../../../archives/><span>Archives</span></a></div></li><li class=nav-item><a class=nav-link href=../../../implementations/><span>Implementations</span></a></li></ul></div><ul class="nav-icons navbar-nav flex-row ml-auto d-flex pl-md-2"><li class=nav-item><a class="nav-link js-search" href=# aria-label=Search><i class="fas fa-search" aria-hidden=true></i></a></li></ul></div></nav></header></div><div class=page-body><div class="container-fluid docs"><div class="row flex-xl-nowrap"><div class="col-12 col-md-3 col-xl-2 docs-sidebar"><form class="docs-search d-flex align-items-center"><button class="btn docs-toggle d-md-none p-0 mr-md-3 w-100" type=button data-toggle=collapse data-target=#docs-nav aria-controls=docs-nav aria-expanded=false aria-label="Toggle section navigation"><div class=d-flex><span class="d-md-none pl-1 flex-grow-1 text-left overflow-hidden">Calypso layer specification
</span><span><i class="fas fa-chevron-down"></i></span></div></button>
<button class="form-control sidebar-search js-search d-none d-md-flex">
<i class="fas fa-search pr-2"></i>
<span class=sidebar-search-text>Search...</span>
<span class=sidebar-search-shortcut>/</span></button></form><nav class="collapse docs-links" id=docs-nav><ul class="nav docs-sidenav"><li><a href=../../../specifications/></a></li><div class=docs-toc-item><a class=docs-toc-link href=../../../specifications/reader-layer/>Reader layer specification</a><ul class="nav docs-sidenav"><li><a href=../../../specifications/reader-layer/reader-api/>ðŸŸ¢ Reader</a></li><li><a href=../../../specifications/reader-layer/card-api/>ðŸ”¶ Card</a></li></ul></div><div class=docs-toc-item><a class=docs-toc-link href=../../../specifications/calypso-layer/>Calypso layer specification</a><ul class="nav docs-sidenav"><li class=active><a href=../../../specifications/calypso-layer/calypso-card-api/>ðŸŸ¢ Calypso Card</a></li><li><a href=../../../specifications/calypso-layer/calypso-legacysam-api/>ðŸŸ¢ Legacy SAM</a></li><li><a href=../../../specifications/calypso-layer/calypso-symmetric-crypto-api/>ðŸ”¶ Symmetric Crypto</a></li><li><a href=../../../specifications/calypso-layer/calypso-asymmetric-crypto-api/>ðŸ”¶ Asymmetric Crypto</a></li></ul></div></ul></nav></div><div class="d-none d-xl-block col-xl-2 docs-toc"><ul class="nav toc-top"><li><a href=# id=back_to_top class=docs-toc-title>Contents</a></li></ul><nav id=TableOfContents><ul><li><a href=#interfaces>Interfaces</a></li><li><a href=#selection-of-a-calypso-card>Selection of a Calypso card</a></li><li><a href=#calypso-card-transaction-without-secure-session>Calypso card transaction without secure session</a><ul><li><a href=#_plain_-pin-verification-or-update><em>Plain</em> PIN Verification or Update</a></li><li><a href=#_ciphered_-key--pin-update-outside-a-session><em>Ciphered</em> Key / PIN update outside a session</a></li><li><a href=#data-secure-processing-data-pso-_signature_--_ciphering_-outside-a-session>Data secure processing (data PSO <em>signature</em> / <em>ciphering</em>) outside a session</a></li><li><a href=#stored-value-operation-outside-a-session>Stored Value operation outside a session</a></li></ul></li><li><a href=#secure-session-with-a-calypso-card>Secure session with a Calypso card</a><ul><li><a href=#_regular_-secure-session-span-stylecolor-redoptimized-for-fast-embedded-performancespan><em>Regular</em> secure session <span style=color:red>optimized for fast <strong>embedded</strong> performance</span></a></li><li><a href=#_regular_-secure-session-span-stylecolor-redoptimized-for-an-efficient-distributed-systemspan><em>Regular</em> secure session <span style=color:red>optimized for an efficient <strong>distributed</strong> system</span></a></li><li><a href=#pin-ciphered-verification-inside-a-session>PIN ciphered verification inside a session</a></li><li><a href=#data-secure-processing-data-pso-_signature_--_ciphering_-inside-a-session>Data secure processing (data PSO <em>signature</em> / <em>ciphering</em>) inside a session</a></li><li><a href=#stored-value-operation-inside-a-session>Stored Value operation inside a session</a></li></ul></li><li><a href=#multiple-secure-sessions>Multiple secure sessions</a></li></ul></nav></div><main class="col-12 col-md-9 col-xl-8 py-md-3 pl-md-5 docs-content" role=main><div class=docs-article-container></div><div class=docs-article-container><h1>Calypso Card API (external)</h1><article class=article-style><div class="alert alert-note"><div>Latest version <strong><code>2.1.0</code></strong>
<span class=component-metadata><i class="fas fa-project-diagram pr-1 fa-fw"></i> <a href=https://calypso-card-uml.terminal-api.calypsonet.org/ target=_blank rel=noopener>UML class diagram</a></span>
<span class=component-metadata><i class="fab fa-github pr-1 fa-fw"></i> <a href=https://github.com/calypsonet/calypsonet-terminal-calypso-card-uml-api/ target=_blank rel=noopener>GitHub repository</a></span></div></div><p>As part of the <strong>Card Layer</strong>, the <strong>Calypso Card API</strong> provides high-level functionality for selecting and performing
transactions with Calypso cards.</p><br><h2 id=interfaces>Interfaces</h2><p>The <strong>Calypso Card API</strong> provides the means to select a target card and then perform a transaction with the selected card.</p><ul><li>The result of a card selection is a smartcard image whose file structure and data records can be browsed.</li><li>A transaction with a target card may involve a control SAM in order to secure the operations.</li></ul><p>The <code>CalypsoCard</code> interfaces provide <strong>accessors</strong> in order to recover the information of the selected smart card.</p><p>To optimize the number of exchanges with a card reader, the <strong>Calypso Card API</strong> allows to group the commands.
A set of command could be first <strong>prepared</strong>, and then be <strong>processed</strong> by a selected target at the selection or
during the transaction.
A transaction with a Calypso card is fully managed through the <code>CardTransactionManager</code> interface:</p><p><figure><div class="d-flex justify-content-center"><div class=w-100><img src=https://calypso-card-uml.terminal-api.calypsonet.org/2.1.0/api_class_diagram.svg alt="Calypso Card API - class diagram" loading=lazy data-zoomable></div></div></figure></p><br><h2 id=selection-of-a-calypso-card>Selection of a Calypso card</h2><p>A Calypso card selection could be defined to accept or not invalidated card.</p><p>Through the selection only basic Select File (without changing DF) or Read Records commands could joined: the goal is to
recover in the selection result some file status or record data of elements present in all cards of a ticketing networks.
The type of card product has not yet been identified, the commands are prepared to be supported by all types of card
products: Prime, Light, or Regular.</p><p>Then, if a Calypso card has matched the selection request, a Calypso card image is returned, some file headers or file
records could be filled depending on the information recovered in the responses of the Select File or Read Records
processed.</p><br><h2 id=calypso-card-transaction-without-secure-session>Calypso card transaction without secure session</h2><p>Except the operations involving secure processing on &ldquo;data&rdquo; (data signature computation / verification, data ciphering /
un-ciphering), only commands for the card need to be prepared though the Card Transaction Manager interface.
Depending on the operation, if necessary the security involving the master SAM must be controlled internally by the
Calypso library.</p><h3 id=_plain_-pin-verification-or-update><em>Plain</em> PIN Verification or Update</h3><figure id=figure-calypso-card-api---verify--change-plain-pin---sequence-diagram><div class="d-flex justify-content-center"><div class=w-100><img src=../../../media/specifications/calypso_transaction_Verify_Change_Plain_PIN_sequence_diagram.svg alt="Calypso Card API - Verify / Change Plain PIN - Sequence Diagram" loading=lazy data-zoomable></div></div><figcaption>Calypso Card API - Verify / Change Plain PIN - Sequence Diagram</figcaption></figure><h3 id=_ciphered_-key--pin-update-outside-a-session><em>Ciphered</em> Key / PIN update outside a session</h3><figure id=figure-calypso-card-api---change-key--ciphered-pin-outside-a-session---sequence-diagram><div class="d-flex justify-content-center"><div class=w-100><img src=../../../media/specifications/calypso_transaction_Change_Key_Ciphered_PIN_sequence_diagram.svg alt="Calypso Card API - Change Key / Ciphered PIN outside a session - Sequence Diagram" loading=lazy data-zoomable></div></div><figcaption>Calypso Card API - Change Key / Ciphered PIN outside a session - Sequence Diagram</figcaption></figure><h3 id=data-secure-processing-data-pso-_signature_--_ciphering_-outside-a-session>Data secure processing (data PSO <em>signature</em> / <em>ciphering</em>) outside a session</h3><figure id=figure-calypso-card-api---data-secure-processing-outside-a-session---sequence-diagram><div class="d-flex justify-content-center"><div class=w-100><img src=../../../media/specifications/calypso_transaction_DSP_outside_session_sequence_diagram.svg alt="Calypso Card API - Data secure processing outside a session - Sequence Diagram" loading=lazy data-zoomable></div></div><figcaption>Calypso Card API - Data secure processing outside a session - Sequence Diagram</figcaption></figure><h3 id=stored-value-operation-outside-a-session>Stored Value operation outside a session</h3><figure id=figure-calypso-card-api---standalone-stored-value-transaction---sequence-diagram><div class="d-flex justify-content-center"><div class=w-100><img src=../../../media/specifications/calypso_transaction_standalone_SV_operation_sequence_diagram.svg alt="Calypso Card API - standalone Stored Value transaction - Sequence Diagram" loading=lazy data-zoomable></div></div><figcaption>Calypso Card API - standalone Stored Value transaction - Sequence Diagram</figcaption></figure><h2 id=secure-session-with-a-calypso-card>Secure session with a Calypso card</h2><h3 id=_regular_-secure-session-span-stylecolor-redoptimized-for-fast-embedded-performancespan><em>Regular</em> secure session <span style=color:red>optimized for fast <strong>embedded</strong> performance</span></h3><p>This example illustrates the ticketing processing of a validation: only the necessary data is read from the card.</p><p>In case of communication failure with the card, to support a recovery transaction on another terminal: the ratification
status and the last event are checked at the session opening, and the session is closed as not ratified directly
followed by a ratification command.</p><figure id=figure-calypso-card-api---simple-secure-session---sequence-diagram><div class="d-flex justify-content-center"><div class=w-100><img src=../../../media/specifications/calypso_transaction_regular_secure_session_optimized_embedded_sequence_diagram.svg alt="Calypso Card API - Simple Secure Session - Sequence Diagram" loading=lazy data-zoomable></div></div><figcaption>Calypso Card API - Simple Secure Session - Sequence Diagram</figcaption></figure><h3 id=_regular_-secure-session-span-stylecolor-redoptimized-for-an-efficient-distributed-systemspan><em>Regular</em> secure session <span style=color:red>optimized for an efficient <strong>distributed</strong> system</span></h3><p>In most of the cases, it should be possible to handle a secure session with a Calypso card, using only:</p><ul><li>3 exchanges with the card reader (selection processing, session opening processing, and session closing processing),</li><li>and 3 exchanges with the SAM reader (terminal session challenge recovery, session MAC computation, and card authentication).</li></ul><p>This example shows the loading of a contract during a sale, to speed up the identification of the card content while
limiting the exchange of messages with the card reader, some data can be read out of session during the selection,
then read again during the session.</p><p>In case of communication failure with the card, if the recovery transaction is supported only on the same terminal,
then the checking of the ratification status is not necessary at the session opening, and the session could be closed as ratified.</p><figure id=figure-calypso-card-api---simple-secure-session---sequence-diagram><div class="d-flex justify-content-center"><div class=w-100><img src=../../../media/specifications/calypso_transaction_simple_secure_session_distributed_sequence_diagram.svg alt="Calypso Card API - Simple Secure Session - Sequence Diagram" loading=lazy data-zoomable></div></div><figcaption>Calypso Card API - Simple Secure Session - Sequence Diagram</figcaption></figure><h3 id=pin-ciphered-verification-inside-a-session>PIN ciphered verification inside a session</h3><figure id=figure-calypso-card-api---verify-ciphered-pin-inside-a-session---sequence-diagram><div class="d-flex justify-content-center"><div class=w-100><img src=../../../media/specifications/calypso_transaction_Verify_Ciphered_PIN_inside_session_sequence_diagram.svg alt="Calypso Card API - Verify Ciphered PIN inside a session - Sequence Diagram" loading=lazy data-zoomable></div></div><figcaption>Calypso Card API - Verify Ciphered PIN inside a session - Sequence Diagram</figcaption></figure><h3 id=data-secure-processing-data-pso-_signature_--_ciphering_-inside-a-session>Data secure processing (data PSO <em>signature</em> / <em>ciphering</em>) inside a session</h3><figure id=figure-calypso-card-api---data-secure-processing-inside-a-session---sequence-diagram><div class="d-flex justify-content-center"><div class=w-100><img src=../../../media/specifications/calypso_transaction_DSP_inside_session_sequence_diagram.svg alt="Calypso Card API - Data secure processing inside a session - Sequence Diagram" loading=lazy data-zoomable></div></div><figcaption>Calypso Card API - Data secure processing inside a session - Sequence Diagram</figcaption></figure><h3 id=stored-value-operation-inside-a-session>Stored Value operation inside a session</h3><figure id=figure-calypso-card-api---stored-value-transaction-inside-a-secure-session---sequence-diagram><div class="d-flex justify-content-center"><div class=w-100><img src=../../../media/specifications/calypso_transaction_SV_inside_session_sequence_diagram.svg alt="Calypso Card API - Stored Value transaction inside a secure session - Sequence Diagram" loading=lazy data-zoomable></div></div><figcaption>Calypso Card API - Stored Value transaction inside a secure session - Sequence Diagram</figcaption></figure><h2 id=multiple-secure-sessions>Multiple secure sessions</h2><figure id=figure-calypso-card-api---multiple-secure-session---sequence-diagram><div class="d-flex justify-content-center"><div class=w-100><img src=../../../media/specifications/calypso_transaction_multiple_secure_session_sequence_diagram.svg alt="Calypso Card API - Multiple secure session - Sequence Diagram" loading=lazy data-zoomable></div></div><figcaption>Calypso Card API - Multiple secure session - Sequence Diagram</figcaption></figure></article><div class=article-widget><div class=post-nav><div class=post-nav-item><div class=meta-nav>Next</div><a href=../../../specifications/calypso-layer/calypso-legacysam-api/ rel=prev>Calypso Legacy SAM API (external)</a></div></div></div></div><div class=body-footer><p>Last updated on 2024-10-31</p></div><footer class=site-footer><p class="powered-by copyright-license-text">Â© 2021-2024 Calypso Networks Association. All Rights Reserved.</p><p class=powered-by id=template-info>Published with <a href="https://hugoblox.com/?utm_campaign=poweredby" target=_blank rel=noopener>Hugo Blox Builder</a> â€” the free, <a href=https://github.com/HugoBlox/hugo-blox-builder target=_blank rel=noopener>open source</a> website builder that empowers creators.</p></footer></main></div></div></div><div class=page-footer></div><script src=../../../js/vendor-bundle.min.938a3a7554cd9f6602290411f64d2617.js></script><script src=https://cdn.jsdelivr.net/npm/leaflet@1.7.1/dist/leaflet.min.js integrity crossorigin=anonymous></script><script src=https://cdn.jsdelivr.net/npm/anchor-js@5.0.0/anchor.min.js integrity="sha256-aQmOEF2ZD4NM/xt4hthzREIo/2PFkOX/g01WjxEV7Ys=" crossorigin=anonymous></script><script>anchors.add()</script><script id=search-hit-fuse-template type=text/x-template>
    <div class="search-hit" id="summary-{{key}}">
      <div class="search-hit-content">
        <div class="search-hit-name">
          <a href="{{relpermalink}}">{{title}}</a>
          <div class="article-metadata search-hit-type">{{type}}</div>
          <p class="search-hit-description">{{snippet}}</p>
        </div>
      </div>
    </div>
  </script><script src=https://cdn.jsdelivr.net/gh/krisk/Fuse@v3.2.1/dist/fuse.min.js integrity="sha512-o38bmzBGX+hD3JHWUFCDA09btWaqrNmoJ3RXLlrysA7PP01Kgs4UlE4MhelE1v5dJR3+cxlR4qQlotsW7jKsnw==" crossorigin=anonymous></script><script src=https://cdn.jsdelivr.net/gh/julmot/mark.js@8.11.1/dist/jquery.mark.min.js integrity="sha512-mhbv5DqBMgrWL+32MmsDOt/OAvqr/cHimk6B8y/bx/xS88MVkYGPiVv2ixKVrkywF2qHplNRUvFsAHUdxZ3Krg==" crossorigin=anonymous></script><script id=page-data type=application/json>{"use_headroom":false}</script><script src=../../../en/js/wowchemy.min.66e096c06c98c5401fdb779e481caca2.js></script><script src=../../../js/wowchemy-map.a26e9d2f7238ba5b868384f1c5bc6477.js type=module></script><link rel=stylesheet href=https://cdn.datatables.net/1.11.3/css/dataTables.bootstrap4.min.css><script src=https://cdn.datatables.net/1.11.3/js/jquery.dataTables.min.js></script><script src=https://cdn.datatables.net/1.11.3/js/dataTables.bootstrap4.min.js></script></body></html>
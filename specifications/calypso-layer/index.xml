<?xml version="1.0" encoding="utf-8" standalone="yes"?><rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>Calypso Layer Specification | Smartcard-based Ticketing Terminal APIs by the Calypso Networks Association</title><link>https://terminal-api.calypsonet.org/specifications/calypso-layer/</link><atom:link href="https://terminal-api.calypsonet.org/specifications/calypso-layer/index.xml" rel="self" type="application/rss+xml"/><description>Calypso Layer Specification</description><generator>Hugo Blox Builder (https://hugoblox.com)</generator><language>en-us</language><image><url>https://terminal-api.calypsonet.org/media/logo.svg</url><title>Calypso Layer Specification</title><link>https://terminal-api.calypsonet.org/specifications/calypso-layer/</link></image><item><title>Calypso Card API (external)</title><link>https://terminal-api.calypsonet.org/specifications/calypso-layer/calypso-card-api/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://terminal-api.calypsonet.org/specifications/calypso-layer/calypso-card-api/</guid><description>&lt;div class="alert alert-note">
&lt;div>
Latest version &lt;strong>&lt;code>2.1.2&lt;/code>&lt;/strong>
&lt;span class="component-metadata">
&lt;i class="fas fa-project-diagram pr-1 fa-fw">&lt;/i> &lt;a href="https://docs.terminal-api.calypsonet.org/calypsonet-terminal-calypso-card-uml-api/" target="_blank" rel="noopener">UML class diagram&lt;/a>&lt;/span>
&lt;span class="component-metadata">
&lt;i class="fab fa-github pr-1 fa-fw">&lt;/i> &lt;a href="https://github.com/calypsonet/calypsonet-terminal-calypso-card-uml-api/" target="_blank" rel="noopener">GitHub repository&lt;/a>&lt;/span>
&lt;/div>
&lt;/div>
&lt;p>As part of the &lt;strong>Card Layer&lt;/strong>, the &lt;strong>Calypso Card API&lt;/strong> provides high-level functionality for selecting and performing
transactions with Calypso cards.&lt;/p>
&lt;br>
&lt;h2 id="interfaces">Interfaces&lt;/h2>
&lt;p>The &lt;strong>Calypso Card API&lt;/strong> provides the means to select a target card and then perform a transaction with the selected card.&lt;/p>
&lt;ul>
&lt;li>The result of a card selection is a smartcard image whose file structure and data records can be browsed.&lt;/li>
&lt;li>A transaction with a target card may involve a control SAM in order to secure the operations.&lt;/li>
&lt;/ul>
&lt;p>The &lt;code>CalypsoCard&lt;/code> interfaces provide &lt;strong>accessors&lt;/strong> in order to recover the information of the selected smart card.&lt;/p>
&lt;p>To optimize the number of exchanges with a card reader, the &lt;strong>Calypso Card API&lt;/strong> allows to group the commands.
A set of command could be first &lt;strong>prepared&lt;/strong>, and then be &lt;strong>processed&lt;/strong> by a selected target at the selection or
during the transaction.
A transaction with a Calypso card is fully managed through the &lt;code>CardTransactionManager&lt;/code> interface:&lt;/p>
&lt;p>
&lt;figure >
&lt;div class="d-flex justify-content-center">
&lt;div class="w-100" >&lt;img src="https://docs.terminal-api.calypsonet.org/calypsonet-terminal-calypso-card-uml-api/2.1.2/api_class_diagram.svg" alt="Calypso Card API - class diagram" loading="lazy" data-zoomable />&lt;/div>
&lt;/div>&lt;/figure>
&lt;/p>
&lt;br>
&lt;h2 id="selection-of-a-calypso-card">Selection of a Calypso card&lt;/h2>
&lt;p>A Calypso card selection could be defined to accept or not invalidated card.&lt;/p>
&lt;p>Through the selection only basic Select File (without changing DF) or Read Records commands could joined: the goal is to
recover in the selection result some file status or record data of elements present in all cards of a ticketing networks.
The type of card product has not yet been identified, the commands are prepared to be supported by all types of card
products: Prime, Light, or Regular.&lt;/p>
&lt;p>Then, if a Calypso card has matched the selection request, a Calypso card image is returned, some file headers or file
records could be filled depending on the information recovered in the responses of the Select File or Read Records
processed.&lt;/p>
&lt;br>
&lt;h2 id="calypso-card-transaction-without-secure-session">Calypso card transaction without secure session&lt;/h2>
&lt;p>Except the operations involving secure processing on &amp;ldquo;data&amp;rdquo; (data signature computation / verification, data ciphering /
un-ciphering), only commands for the card need to be prepared though the Card Transaction Manager interface.
Depending on the operation, if necessary the security involving the master SAM must be controlled internally by the
Calypso library.&lt;/p>
&lt;h3 id="_plain_-pin-verification-or-update">&lt;em>Plain&lt;/em> PIN Verification or Update&lt;/h3>
&lt;figure id="figure-calypso-card-api---verify--change-plain-pin---sequence-diagram">
&lt;div class="d-flex justify-content-center">
&lt;div class="w-100" >&lt;img src="../../media/specifications/calypso_transaction_Verify_Change_Plain_PIN_sequence_diagram.svg" alt="Calypso Card API - Verify / Change Plain PIN - Sequence Diagram" loading="lazy" data-zoomable />&lt;/div>
&lt;/div>&lt;figcaption>
Calypso Card API - Verify / Change Plain PIN - Sequence Diagram
&lt;/figcaption>&lt;/figure>
&lt;h3 id="_ciphered_-key--pin-update-outside-a-session">&lt;em>Ciphered&lt;/em> Key / PIN update outside a session&lt;/h3>
&lt;figure id="figure-calypso-card-api---change-key--ciphered-pin-outside-a-session---sequence-diagram">
&lt;div class="d-flex justify-content-center">
&lt;div class="w-100" >&lt;img src="../../media/specifications/calypso_transaction_Change_Key_Ciphered_PIN_sequence_diagram.svg" alt="Calypso Card API - Change Key / Ciphered PIN outside a session - Sequence Diagram" loading="lazy" data-zoomable />&lt;/div>
&lt;/div>&lt;figcaption>
Calypso Card API - Change Key / Ciphered PIN outside a session - Sequence Diagram
&lt;/figcaption>&lt;/figure>
&lt;h3 id="data-secure-processing-data-pso-_signature_--_ciphering_-outside-a-session">Data secure processing (data PSO &lt;em>signature&lt;/em> / &lt;em>ciphering&lt;/em>) outside a session&lt;/h3>
&lt;figure id="figure-calypso-card-api---data-secure-processing-outside-a-session---sequence-diagram">
&lt;div class="d-flex justify-content-center">
&lt;div class="w-100" >&lt;img src="../../media/specifications/calypso_transaction_DSP_outside_session_sequence_diagram.svg" alt="Calypso Card API - Data secure processing outside a session - Sequence Diagram" loading="lazy" data-zoomable />&lt;/div>
&lt;/div>&lt;figcaption>
Calypso Card API - Data secure processing outside a session - Sequence Diagram
&lt;/figcaption>&lt;/figure>
&lt;h3 id="stored-value-operation-outside-a-session">Stored Value operation outside a session&lt;/h3>
&lt;figure id="figure-calypso-card-api---standalone-stored-value-transaction---sequence-diagram">
&lt;div class="d-flex justify-content-center">
&lt;div class="w-100" >&lt;img src="../../media/specifications/calypso_transaction_standalone_SV_operation_sequence_diagram.svg" alt="Calypso Card API - standalone Stored Value transaction - Sequence Diagram" loading="lazy" data-zoomable />&lt;/div>
&lt;/div>&lt;figcaption>
Calypso Card API - standalone Stored Value transaction - Sequence Diagram
&lt;/figcaption>&lt;/figure>
&lt;h2 id="secure-session-with-a-calypso-card">Secure session with a Calypso card&lt;/h2>
&lt;h3 id="_regular_-secure-session-span-stylecolor-redoptimized-for-fast-embedded-performancespan">&lt;em>Regular&lt;/em> secure session &lt;span style="color: red;">optimized for fast &lt;strong>embedded&lt;/strong> performance&lt;/span>&lt;/h3>
&lt;p>This example illustrates the ticketing processing of a validation: only the necessary data is read from the card.&lt;/p>
&lt;p>For access control to a transit network or a building, using a contactless card to authenticate the holder&amp;rsquo;s rights, ticketing terminals are generally automatic machines for which the rights verification transaction is automatically launched when the contactless card is detected in the RF field emitted by the terminal&amp;rsquo;s reader. For transactions to run smoothly, without the need for error recovery, it is important that the contactless transaction with the card is very fast, and that the card presentation and withdrawal detection phases are reliably managed.&lt;/p>
&lt;p>The aim is to &lt;u>save milliseconds&lt;/u> by minimizing the volume of data transmitted during contactless communication with the card to complete the ticketing transaction.&lt;br>
In order to limit the amount of data to be read from the card to the strict minimum, card reading operations cannot be grouped together. Each card response needs to be analyzed, to determine whether the next reading operation is necessary. Reducing the volume of data transmitted by the contactless card reader also reduces the amount of data to be transmitted to the SAM reader during the session, in order to update the session hash calculation.&lt;br>
On the SAM side, it is necessary to:&lt;/p>
&lt;ul>
&lt;li>limit the number of operations to be performed during the contactless card transaction: SAM challenge recovery can be anticipated before a card transaction.&lt;/li>
&lt;li>group as many SAM exchanges as possible to be processed during the session (to counteract contact reader latency, and to share an APDU command header with a maximum amount of data to be transmitted)&lt;/li>
&lt;/ul>
&lt;p>It is therefore necessary to anticipate card responses to write commands (counter increment/decrement). Under these conditions, only one group of SAM commands is needed during the card transaction to generate the SAM session MAC. Card authenticity verification can be performed while waiting for card removal.&lt;/p>
&lt;p>The contactless reader of a configured and active ticketing terminal can switch between 3 states:&lt;/p>
&lt;ul>
&lt;li>in &amp;lsquo;&lt;em>standby mode&lt;/em>&amp;rsquo;, the reader is waiting for a new card to be detected.&lt;/li>
&lt;li>when a card is detected, the reader is in card &amp;lsquo;&lt;em>processing mode&lt;/em>&amp;rsquo;.&lt;/li>
&lt;li>when the card transaction is completed, the reader is &amp;lsquo;&lt;em>waiting for the removal&lt;/em>&amp;rsquo; of the card.
Following a card transaction, a terminal must be sure that the card has indeed been removed from the RF field, before considering detecting a new one.&lt;/li>
&lt;/ul>
&lt;p>For this reason, a terminal cannot be confident of a timeout at the transaction completion, as this timeout will either be too short (the previous card still present will be grabbed again) or too long (the terminal will remain unavailable for a long time). The contactless reader shall notify the withdrawal of the card.&lt;/p>
&lt;p>For a ticketing transaction during which card data is updated (right decrementation, memorization of an event), the “ratification” mechanism supported by the Calypso secure session guarantees that the cardholder will not lose any rights if the RF transmission with the card is interrupted.&lt;br>
When a session is opened, the verification of a last ticketing event makes it possible to identify whether a card has been presented twice in quick succession on an access control line.&lt;br>
In the case of very recent event, the card&amp;rsquo;s “unratified” status can be used to determine whether&lt;/p>
&lt;ul>
&lt;li>whether it is a recovery transaction, for which it may be necessary to re-authenticate the cardholder without debiting new rights;&lt;/li>
&lt;li>or if it is an attempt to obtain a second access for another person (anti-passback).&lt;/li>
&lt;/ul>
&lt;p>When a session is closed, the ratification command is immediately transmitted to the card, to minimize the need for transaction recovery.&lt;/p>
&lt;figure id="figure-calypso-card-api---simple-secure-session---sequence-diagram">
&lt;div class="d-flex justify-content-center">
&lt;div class="w-100" >&lt;img src="../../media/specifications/calypso_transaction_regular_secure_session_optimized_embedded_sequence_diagram.svg" alt="Calypso Card API - Simple Secure Session - Sequence Diagram" loading="lazy" data-zoomable />&lt;/div>
&lt;/div>&lt;figcaption>
Calypso Card API - Simple Secure Session - Sequence Diagram
&lt;/figcaption>&lt;/figure>
&lt;h3 id="_regular_-secure-session-span-stylecolor-redoptimized-for-an-efficient-distributed-systemspan">&lt;em>Regular&lt;/em> secure session &lt;span style="color: red;">optimized for an efficient &lt;strong>distributed&lt;/strong> system&lt;/span>&lt;/h3>
&lt;p>In most of the cases, it should be possible to handle a secure session with a Calypso card, using only:&lt;/p>
&lt;ul>
&lt;li>3 exchanges with the card reader (selection processing, session opening processing, and session closing processing),&lt;/li>
&lt;li>and 3 exchanges with the SAM reader (terminal session challenge recovery, session MAC computation, and card authentication).&lt;/li>
&lt;/ul>
&lt;p>This example shows the loading of a contract during a sale, to speed up the identification of the card content while
limiting the exchange of messages with the card reader, some data can be read out of session during the selection,
then read again during the session.&lt;/p>
&lt;p>In case of communication failure with the card, if the recovery transaction is supported only on the same terminal,
then the checking of the ratification status is not necessary at the session opening, and the session could be closed as ratified.&lt;/p>
&lt;figure id="figure-calypso-card-api---simple-secure-session---sequence-diagram">
&lt;div class="d-flex justify-content-center">
&lt;div class="w-100" >&lt;img src="../../media/specifications/calypso_transaction_simple_secure_session_distributed_sequence_diagram.svg" alt="Calypso Card API - Simple Secure Session - Sequence Diagram" loading="lazy" data-zoomable />&lt;/div>
&lt;/div>&lt;figcaption>
Calypso Card API - Simple Secure Session - Sequence Diagram
&lt;/figcaption>&lt;/figure>
&lt;h3 id="pin-ciphered-verification-inside-a-session">PIN ciphered verification inside a session&lt;/h3>
&lt;figure id="figure-calypso-card-api---verify-ciphered-pin-inside-a-session---sequence-diagram">
&lt;div class="d-flex justify-content-center">
&lt;div class="w-100" >&lt;img src="../../media/specifications/calypso_transaction_Verify_Ciphered_PIN_inside_session_sequence_diagram.svg" alt="Calypso Card API - Verify Ciphered PIN inside a session - Sequence Diagram" loading="lazy" data-zoomable />&lt;/div>
&lt;/div>&lt;figcaption>
Calypso Card API - Verify Ciphered PIN inside a session - Sequence Diagram
&lt;/figcaption>&lt;/figure>
&lt;h3 id="data-secure-processing-data-pso-_signature_--_ciphering_-inside-a-session">Data secure processing (data PSO &lt;em>signature&lt;/em> / &lt;em>ciphering&lt;/em>) inside a session&lt;/h3>
&lt;figure id="figure-calypso-card-api---data-secure-processing-inside-a-session---sequence-diagram">
&lt;div class="d-flex justify-content-center">
&lt;div class="w-100" >&lt;img src="../../media/specifications/calypso_transaction_DSP_inside_session_sequence_diagram.svg" alt="Calypso Card API - Data secure processing inside a session - Sequence Diagram" loading="lazy" data-zoomable />&lt;/div>
&lt;/div>&lt;figcaption>
Calypso Card API - Data secure processing inside a session - Sequence Diagram
&lt;/figcaption>&lt;/figure>
&lt;h3 id="stored-value-operation-inside-a-session">Stored Value operation inside a session&lt;/h3>
&lt;figure id="figure-calypso-card-api---stored-value-transaction-inside-a-secure-session---sequence-diagram">
&lt;div class="d-flex justify-content-center">
&lt;div class="w-100" >&lt;img src="../../media/specifications/calypso_transaction_SV_inside_session_sequence_diagram.svg" alt="Calypso Card API - Stored Value transaction inside a secure session - Sequence Diagram" loading="lazy" data-zoomable />&lt;/div>
&lt;/div>&lt;figcaption>
Calypso Card API - Stored Value transaction inside a secure session - Sequence Diagram
&lt;/figcaption>&lt;/figure>
&lt;h2 id="multiple-secure-sessions">Multiple secure sessions&lt;/h2>
&lt;figure id="figure-calypso-card-api---multiple-secure-session---sequence-diagram">
&lt;div class="d-flex justify-content-center">
&lt;div class="w-100" >&lt;img src="../../media/specifications/calypso_transaction_multiple_secure_session_sequence_diagram.svg" alt="Calypso Card API - Multiple secure session - Sequence Diagram" loading="lazy" data-zoomable />&lt;/div>
&lt;/div>&lt;figcaption>
Calypso Card API - Multiple secure session - Sequence Diagram
&lt;/figcaption>&lt;/figure></description></item><item><title>Calypso Legacy SAM API (external)</title><link>https://terminal-api.calypsonet.org/specifications/calypso-layer/calypso-legacysam-api/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://terminal-api.calypsonet.org/specifications/calypso-layer/calypso-legacysam-api/</guid><description>&lt;div class="alert alert-note">
&lt;div>
Latest version &lt;strong>&lt;code>0.7.0&lt;/code>&lt;/strong>
&lt;span class="component-metadata">
&lt;i class="fas fa-project-diagram pr-1 fa-fw">&lt;/i> &lt;a href="https://docs.terminal-api.calypsonet.org/calypsonet-terminal-calypso-crypto-legacysam-uml-api/" target="_blank" rel="noopener">UML class diagram&lt;/a>&lt;/span>
&lt;span class="component-metadata">
&lt;i class="fab fa-github pr-1 fa-fw">&lt;/i> &lt;a href="https://github.com/calypsonet/calypsonet-terminal-calypso-crypto-legacysam-uml-api/" target="_blank" rel="noopener">GitHub repository&lt;/a>&lt;/span>
&lt;/div>
&lt;/div>
&lt;p>As part of the &lt;strong>Card Layer&lt;/strong>, the &lt;strong>Calypso Crypto Legacy SAM API&lt;/strong> provides high-level functionality for selecting
and performing transactions with Calypso Legacy SAMs and can also be coupled with the &lt;strong>Calypso Card API&lt;/strong> to handle the
cryptographic calculations required for Calypso card transactions secured by symmetric keys.&lt;/p>
&lt;br>
&lt;h2 id="interfaces">Interfaces&lt;/h2>
&lt;p>The &lt;strong>Calypso Crypto Legacy SAM API&lt;/strong> provides the means to select a target or control SAM and then perform a transaction with the selected target.&lt;/p>
&lt;ul>
&lt;li>The result of a SAM selection is a smartcard image whose keys&amp;rsquo; parameters can be read.&lt;/li>
&lt;li>A transaction with a target SAM may involve a control SAM in order to secure the operations.&lt;/li>
&lt;/ul>
&lt;p>The &lt;code>LegacySam&lt;/code> interface provide &lt;strong>accessors&lt;/strong> in order to recover the information of the selected smartcard.&lt;/p>
&lt;p>To optimize the number of exchanges with a SAM reader, the Legacy SAM API allows to group the commands.
A set of command could be first &lt;strong>prepared&lt;/strong>, and then be &lt;strong>processed&lt;/strong> by a selected target at the selection or
during the transaction.
A transaction with a Calypso SAM is fully managed through one of the &lt;code>LSTransactionManager&lt;/code> interfaces:&lt;/p>
&lt;p>
&lt;figure >
&lt;div class="d-flex justify-content-center">
&lt;div class="w-100" >&lt;img src="https://docs.terminal-api.calypsonet.org/calypsonet-terminal-calypso-crypto-legacysam-uml-api/0.7.0/api_class_diagram.svg" alt="Calypso Crypto Legacy SAM API - class diagram" loading="lazy" data-zoomable />&lt;/div>
&lt;/div>&lt;/figure>
&lt;/p></description></item><item><title>Calypso Symmetric Crypto API (internal)</title><link>https://terminal-api.calypsonet.org/specifications/calypso-layer/calypso-symmetric-crypto-api/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://terminal-api.calypsonet.org/specifications/calypso-layer/calypso-symmetric-crypto-api/</guid><description>&lt;div class="alert alert-note">
&lt;div>
Latest version &lt;strong>&lt;code>0.1.1&lt;/code>&lt;/strong>
&lt;span class="component-metadata">
&lt;i class="fas fa-project-diagram pr-1 fa-fw">&lt;/i> &lt;a href="https://docs.terminal-api.calypsonet.org/calypsonet-terminal-calypso-crypto-symmetric-uml-api/" target="_blank" rel="noopener">UML class diagram&lt;/a>&lt;/span>
&lt;span class="component-metadata">
&lt;i class="fab fa-github pr-1 fa-fw">&lt;/i> &lt;a href="https://github.com/calypsonet/calypsonet-terminal-calypso-crypto-symmetric-uml-api/" target="_blank" rel="noopener">GitHub repository&lt;/a>&lt;/span>
&lt;/div>
&lt;/div>
&lt;p>The &lt;strong>Calypso Crypto Symmetric API&lt;/strong> is the communication interface between the &lt;strong>Calypso Card&lt;/strong> and the
&lt;strong>Calypso Symmetric Crypto&lt;/strong> libraries (e.g. Legacy SAM, Open SAM).&lt;/p>
&lt;br>
&lt;h2 id="interfaces">Interfaces&lt;/h2>
&lt;p>
&lt;figure >
&lt;div class="d-flex justify-content-center">
&lt;div class="w-100" >&lt;img src="https://docs.terminal-api.calypsonet.org/calypsonet-terminal-calypso-crypto-symmetric-uml-api/0.1.1/api_class_diagram.svg" alt="Card API - class diagram" loading="lazy" data-zoomable />&lt;/div>
&lt;/div>&lt;/figure>
&lt;/p></description></item><item><title>Calypso Asymmetric Crypto API (internal)</title><link>https://terminal-api.calypsonet.org/specifications/calypso-layer/calypso-asymmetric-crypto-api/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://terminal-api.calypsonet.org/specifications/calypso-layer/calypso-asymmetric-crypto-api/</guid><description>&lt;div class="alert alert-note">
&lt;div>
Latest version &lt;strong>&lt;code>0.2.0&lt;/code>&lt;/strong>
&lt;span class="component-metadata">
&lt;i class="fas fa-project-diagram pr-1 fa-fw">&lt;/i> &lt;a href="https://docs.terminal-api.calypsonet.org/calypsonet-terminal-calypso-crypto-asymmetric-uml-api/" target="_blank" rel="noopener">UML class diagram&lt;/a>&lt;/span>
&lt;span class="component-metadata">
&lt;i class="fab fa-github pr-1 fa-fw">&lt;/i> &lt;a href="https://github.com/calypsonet/calypsonet-terminal-calypso-crypto-asymmetric-uml-api/" target="_blank" rel="noopener">GitHub repository&lt;/a>&lt;/span>
&lt;/div>
&lt;/div>
&lt;p>The &lt;strong>Calypso Crypto Asymmetric API&lt;/strong> is the communication interface between the &lt;strong>Calypso Card&lt;/strong> and the
&lt;strong>Calypso Asymmetric Crypto&lt;/strong> libraries.&lt;/p>
&lt;br>
&lt;h2 id="interfaces">Interfaces&lt;/h2>
&lt;p>
&lt;figure >
&lt;div class="d-flex justify-content-center">
&lt;div class="w-100" >&lt;img src="https://docs.terminal-api.calypsonet.org/calypsonet-terminal-calypso-crypto-asymmetric-uml-api/0.2.0/api_class_diagram.svg" alt="Card API - class diagram" loading="lazy" data-zoomable />&lt;/div>
&lt;/div>&lt;/figure>
&lt;/p></description></item></channel></rss>